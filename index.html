<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Ways - Ideas Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        /* --- 1. SETTING DASAR & VARIABEL --- */
        :root {
            --primary-grad: linear-gradient(135deg, #0f766e 0%, #2dd4bf 100%); /* Teal Premium */
            --bg-grad: linear-gradient(135deg, #134e4a 0%, #115e59 40%, #0d9488 100%); /* Background Utama Gelap Elegan */
            --card-glass: rgba(255, 255, 255, 0.1);
            --card-border: rgba(255, 255, 255, 0.2);
            --text-white: #ffffff;
            --text-muted: #ccfbf1;
            --danger: #ef4444;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }

      /* --- 1. SETTING BODY DENGAN ANIMASI GRADASI --- */
        body {
            /* Kombinasi 4 Warna Premium yang Selaras:
               1. Dark Slate (#0f172a) - Gelap elegan
               2. Deep Teal (#134e4a) - Warna utama kita
               3. Medium Teal (#0f766e) - Sedikit lebih terang
               4. Deep Green (#042f2e) - Hijau sangat tua
            */
            background: linear-gradient(-45deg, #0f172a, #134e4a, #0f766e, #042f2e);
            
            /* Memperbesar ukuran background agar bisa digerakkan */
            background-size: 400% 400%;
            
            /* Menjalankan animasi 'gradientBG' selama 15 detik, berulang selamanya */
            animation: gradientBG 15s ease infinite;
            
            /* Properti Layout Tetap Sama */
            min-height: 100vh;
            color: var(--text-white);
            display: flex;
            overflow-x: hidden;
        }

        /* Definisi Animasi Pergerakan Warna */
        @keyframes gradientBG {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        /* --- 2. LAYOUT UTAMA --- */
        .sidebar {
            width: 260px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(10px);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            border-right: 1px solid var(--card-border);
        }

        .brand { font-size: 1.8rem; font-weight: 700; margin-bottom: 3rem; letter-spacing: 1px; }

        .menu-item {
            padding: 1rem;
            color: var(--text-muted);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            border-radius: 12px;
            margin-bottom: 0.5rem;
            transition: 0.3s;
        }

        .menu-item.active, .menu-item:hover {
            background: var(--card-glass);
            color: #fff;
            font-weight: 600;
        }

        .main-content {
            flex: 1;
            padding: 3rem;
            overflow-y: auto;
        }

        /* --- 3. DASHBOARD HEADER --- */
        .header { margin-bottom: 3rem; }
        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .header p { color: var(--text-muted); font-weight: 300; }

        .actions { margin-top: 2rem; display: flex; gap: 1rem; }

        .btn-primary {
            background: var(--primary-grad);
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(45, 212, 191, 0.4);
            transition: transform 0.2s, box-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(45, 212, 191, 0.6); }

        /* --- 4. GRID KARTU (Cards) --- */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            padding-bottom: 4rem;
        }
/* --- REVISI TAMPILAN DESKRIPSI & NOTES --- */

        /* 1. Bagian Deskripsi */
        #viewDesc {
            margin-bottom: 1.5rem;
            color: #e0e7ff; 
            
            /* Agar Rata Kanan Kiri */
            text-align: justify; 
            
            /* Agar spasi dan enter yang diinput user terbaca sesuai aslinya */
            white-space: pre-wrap; 
            
            /* Agar kata super panjang (tanpa spasi) dipaksa turun ke bawah */
            word-break: break-word; 
            overflow-wrap: break-word;
            
            /* Jarak antar baris biar enak dibaca */
            line-height: 1.8; 
            font-size: 0.95rem;
        }

        /* 2. Bagian Notes / Catatan Khusus */
      /* REVISI DESAIN NOTES YANG LEBIH ELEGAN */
        #viewNotes {
            position: relative;
            
            /* Background Gradient Halus & Glass Effect */
            background: linear-gradient(160deg, rgba(255, 255, 255, 0.08) 0%, rgba(255, 255, 255, 0.02) 100%);
            backdrop-filter: blur(10px); /* Efek blur di belakang */
            
            /* Border tipis & Shadow lembut */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.3);
            
            padding: 1.8rem 2rem 1.8rem 2.5rem; /* Padding lebih lega */
            border-radius: 16px; /* Sudut lebih membulat */
            margin-bottom: 2rem;
            
            /* Typography */
            color: #e2e8f0;
            font-size: 0.95rem;
            line-height: 1.8;
            font-weight: 300; /* Font sedikit lebih tipis agar elegan */
            font-style: normal; /* Kita buat normal saja biar lebih modern (bukan italic) */
            letter-spacing: 0.3px;
            
            /* Text Layout Fixes */
            text-align: justify;
            white-space: pre-wrap;
            word-break: break-word;
            overflow-wrap: break-word;
            
            /* Dekorasi Transisi */
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            overflow: hidden; /* Agar dekorasi tidak keluar kotak */
        }

        /* Hover Effect: Sedikit terangkat saat disentuh mouse */
        #viewNotes:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.2);
        }

        /* Elemen Dekorasi 1: Garis Aksen Emas di Kiri */
        #viewNotes::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            /* Gradasi Emas ke Oranye */
            
        }

        /* Elemen Dekorasi 2: Ikon Tanda Kutip Raksasa Transparan */
        #viewNotes::after {
            content: '\201C'; /* Kode unicode untuk tanda kutip buka */
            position: absolute;
            top: -10px;
            right: 20px;
            font-size: 6rem;
            line-height: 1;
            font-family: serif; /* Font serif agar kutipnya estetik */
            color: rgba(255, 255, 255, 0.04); /* Sangat transparan */
            pointer-events: none;
        }
        .card {
            background: var(--card-glass);
            border: 1px solid var(--card-border);
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            height: 400px; /* Tinggi tetap agar rapi */
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: rgba(255,255,255, 0.4);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-img {
            height: 180px;
            width: 100%;
            object-fit: cover;
            border-bottom: 1px solid var(--card-border);
        }

        .card-body {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
            cursor: pointer; /* Menandakan bisa diklik untuk detail */
        }

        .card-tag {
            font-size: 0.75rem;
            background: rgba(255,255,255,0.2);
            padding: 4px 10px;
            border-radius: 20px;
            align-self: flex-start;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .card-title { font-size: 1.25rem; font-weight: 600; margin-bottom: 0.5rem; line-height: 1.4; }
       .card-desc {
            font-size: 0.9rem;
            color: var(--text-muted);
            
            /* Logic membatasi hanya 2 baris */
            display: -webkit-box;
            -webkit-line-clamp: 2; 
            -webkit-box-orient: vertical;
            overflow: hidden;
            
            /* --- PERBAIKAN UTAMA --- */
            /* Agar kata panjang tanpa spasi (hshshs...) bisa turun ke bawah */
            word-break: break-word; 
            overflow-wrap: break-word;
            
            /* Agar kartu terlihat rapi & sejajar walau teksnya sedikit */
            min-height: 2.7em; /* Tinggi paksa setara 2 baris */
            line-height: 1.5; /* Jarak antar baris agar mudah dibaca */
            
            margin-bottom: auto;
        } 
        .card-footer {
            margin-top: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 1rem;
        }

        /* Action Buttons di Card (Floating) */
        .card-actions-float {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .card:hover .card-actions-float { opacity: 1; }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: 0.2s;
        }

        .btn-dup { background: rgba(255, 255, 255, 0.2); color: white; }
        .btn-dup:hover { background: rgba(255, 255, 255, 0.4); }
        .btn-del { background: rgba(239, 68, 68, 0.2); color: #fca5a5; }
        .btn-del:hover { background: #ef4444; color: white; }

        /* --- 5. MODAL FORM & DETAIL (Complex) --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            pointer-events: none;
            transition: 0.3s;
        }

        .modal-overlay.active { opacity: 1; pointer-events: all; }

        .modal-box {
            background: linear-gradient(145deg, #175e58, #0f3f3b);
            width: 600px;
            max-width: 90%;
            max-height: 85vh;
            border-radius: 24px;
            border: 1px solid var(--card-border);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: scale(0.9);
            transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .modal-overlay.active .modal-box { transform: scale(1); }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--card-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.1);
        }

        .modal-body {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
        }

        /* Styling Form yang Kompleks */
        .form-group { margin-bottom: 1.5rem; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }
        
        label { display: block; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-muted); }
        
        input, select, textarea {
            width: 100%;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid var(--card-border);
            padding: 0.8rem 1rem;
            border-radius: 10px;
            color: white;
            font-size: 0.95rem;
            transition: 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2dd4bf;
            background: rgba(0, 0, 0, 0.3);
            box-shadow: 0 0 0 3px rgba(45, 212, 191, 0.2);
        }

        textarea { resize: vertical; min-height: 100px; }

        /* Detail View Styling */
        .detail-view h2 { font-size: 2rem; margin-bottom: 0.5rem; }
        .detail-meta { display: flex; gap: 1rem; margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--text-muted); }
        .detail-img { width: 100%; height: 250px; object-fit: cover; border-radius: 12px; margin-bottom: 1.5rem; }
        .detail-content { line-height: 1.8; color: #e0e7ff; white-space: pre-wrap; }

        .modal-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--card-border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            background: rgba(0,0,0,0.1);
        }

        .btn-cancel { background: transparent; border: 1px solid var(--card-border); color: white; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; }
        .btn-save { background: var(--primary-grad); border: none; color: white; padding: 0.6rem 1.5rem; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        /* Utility */
        .hidden { display: none; }
        /* --- STYLE SEARCH & FILTER BAR --- */
        
        /* Wrapper Input Search */
        /* --- REVISI SEARCH BAR (LEBIH LEBAR & CLEAN) --- */
        
        /* 1. Wrapper Search Bar */
        .search-box-wrapper {
            flex: 2; /* Prioritas lebih lebar daripada tombol lain */
            min-width: 650px; /* Ukuran fix diperlebar signifikan */
            height: 50px; /* Tinggi fix agar terlihat gagah */
            
            background: rgba(0, 0, 0, 0.2); /* Background transparan gelap */
            backdrop-filter: blur(5px);
            
            border: 1px solid rgba(255, 255, 255, 0.1); /* Border awal tipis */
            border-radius: 50px;
            
            padding: 0 1.5rem; /* Ruang dalam lebih lega */
            display: flex;
            align-items: center;
            gap: 12px;
            
            transition: all 0.3s ease; /* Transisi halus */
        }
        
        /* 2. Efek Saat Fokus (Dibersihkan) */
        .search-box-wrapper:focus-within {
            background: rgba(0, 0, 0, 0.4); /* Lebih gelap dikit biar teks jelas */
            border-color: #2dd4bf; /* Ganti warna border jadi Teal (Tanpa Glow Aneh) */
            
            /* PENTING: Menghapus shadow/glow yang bikin efek 'kotor' */
            box-shadow: none; 
            outline: none;
            border-radius: 50px;
        }

        /* 3. Input Field di dalamnya */
        .search-box-wrapper input {
            background: transparent;
            border: none;
            padding: 0;
            color: #ffffff;
            width: 100%;
            height: 100%;
            
            /* PENTING: Mematikan outline biru bawaan browser */
            outline: none; 
            
            font-size: 1rem; /* Ukuran font lebih pas */
            font-weight: 400;
            letter-spacing: 0.5px;
        }

        /* Styling Placeholder (Teks 'Cari nama tugas...') */
        .search-box-wrapper input::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-weight: 300;
        }

        .search-icon { 
            color: rgba(255, 255, 255, 0.6); 
            font-size: 1.3rem; 
            transition: 0.3s;
        }
        
        /* Saat fokus, ikon ikut menyala */
        .search-box-wrapper:focus-within .search-icon {
            color: #2dd4bf;
        }

        .search-icon { color: var(--text-muted); font-size: 1.2rem; }

        /* Wrapper Filter Select */
        .filter-box-wrapper {
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            display: flex;
            align-items: center;
            padding: 0 1rem;
            transition: 0.3s;
        }
        
        .filter-box-wrapper:hover { background: rgba(0,0,0,0.3); }

        .filter-icon {
            position: absolute;
            left: 1rem;
            color: #2dd4bf;
            font-size: 1.2rem;
            pointer-events: none; /* Supaya klik tembus ke select */
        }

        .filter-box-wrapper select {
            appearance: none; /* Hilangkan panah default browser */
            background: transparent;
            border: none;
            color: white;
            padding: 0.8rem 1rem 0.8rem 2.2rem; /* Padding kiri buat ikon */
            font-size: 0.9rem;
            cursor: pointer;
            outline: none;
            width: 100%;
        }

        /* Styling Option (Dropdown bawaan browser, warna gelap) */
        .filter-box-wrapper select option {
            background: #111827; /* Dark BG */
            color: white;
            padding: 10px;
        }
        /* --- STYLING KHUSUS PLANS --- */
        
     /* --- REVISI CARD PLANS (FULL IMAGE STYLE) --- */
        .plan-card {
            /* Gradient Background */
            background: linear-gradient(160deg, rgba(49, 46, 129, 0.6) 0%, rgba(30, 27, 75, 0.8) 100%);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(167, 139, 250, 0.2);
            border-radius: 20px;
            
            /* [PENTING] Hapus Padding agar gambar menempel ke tepi */
            padding: 0; 
            overflow: hidden; /* Agar sudut gambar ikut melengkung */
            
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            min-height: 320px; /* Sedikit lebih tinggi */
        }

        .plan-card:hover {
            transform: translateY(-5px);
            border-color: rgba(167, 139, 250, 0.5);
            box-shadow: 0 15px 40px -10px rgba(76, 29, 149, 0.5);
        }
        
        /* Area Konten Teks (Judul, Desc, dll) dikasih padding terpisah */
        .plan-card-body {
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            flex: 1; /* Mengisi sisa ruang */
        }
        /* Hiasan Dekoratif di Background Card */
        .plan-card::before {
            content: '';
            position: absolute;
            top: -50px; right: -50px;
            width: 150px; height: 150px;
            background: radial-gradient(circle, rgba(139, 92, 246, 0.2) 0%, transparent 70%);
            border-radius: 50%;
            pointer-events: none;
        }

        .plan-status-badge {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 4px 10px;
            border-radius: 30px;
            align-self: flex-start;
            margin-bottom: 1rem;
            font-weight: 700;
        }

        /* Status Colors */
        .status-draft { background: rgba(148, 163, 184, 0.2); color: #cbd5e1; border: 1px solid rgba(148, 163, 184, 0.3); }
        .status-track { background: rgba(52, 211, 153, 0.2); color: #34d399; border: 1px solid rgba(52, 211, 153, 0.3); }
        .status-risk { background: rgba(248, 113, 113, 0.2); color: #f87171; border: 1px solid rgba(248, 113, 113, 0.3); }
        .status-done { background: rgba(96, 165, 250, 0.2); color: #60a5fa; border: 1px solid rgba(96, 165, 250, 0.3); }

        .plan-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, #fff, #c4b5fd);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .plan-goal {
            font-size: 0.9rem;
            color: #94a3b8;
            line-height: 1.6;
            margin-bottom: auto; /* Push footer ke bawah */
            
            /* Text Truncate & Wrapping Fix */
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-break: break-word;
            overflow-wrap: break-word;
        }

        .plan-footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            color: #64748b;
            font-size: 0.85rem;
        }
        /* Style Khusus Modal Plan */
.btn-gen-purple {
    background: linear-gradient(135deg, #6366f1, #a855f7);
    border: none; color: white; padding: 0.4rem 1rem; border-radius: 6px; cursor: pointer;
}
.dynamic-wrapper { display: flex; flex-direction: column; gap: 1rem; }
.dynamic-item {
    background: rgba(255,255,255,0.05);
    padding: 1rem; border-radius: 8px;
    border: 1px solid rgba(167, 139, 250, 0.2);
    position: relative;
}
.dynamic-item input, .dynamic-item textarea { margin-bottom: 5px; font-size: 0.9rem; }
/* --- 1. REVISI SCROLLBAR TIPIS (Agar sama dengan Ideas) --- */
    /* Target seluruh modal body agar scrollbarnya tipis */
    .modal-body::-webkit-scrollbar {
        width: 6px; /* Lebar tipis */
    }
    .modal-body::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.1); 
    }
    .modal-body::-webkit-scrollbar-thumb {
        background: rgba(167, 139, 250, 0.3); /* Warna Ungu Transparan */
        border-radius: 10px;
    }
    .modal-body::-webkit-scrollbar-thumb:hover {
        background: rgba(167, 139, 250, 0.6);
    }

    /* --- 2. REVISI LABEL STATUS (Badge Style Premium) --- */
    #viewPlanStatusBadge {
        display: inline-block; /* Agar kotak mengikuti konten */
        padding: 6px 16px;
        border-radius: 50px; /* Bentuk Pill/Lonjong */
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 1.2px;
        margin-bottom: 0.5rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2); /* Sedikit bayangan */
        border: 1px solid transparent; /* Persiapan border */
    }
    /* --- STYLE CARD JOURNAL (WARM SUNSET) --- */
    .journal-card {
        /* Gradient Warm: Red/Orange/Dark */
        background: linear-gradient(160deg, rgba(127, 29, 29, 0.6) 0%, rgba(69, 10, 10, 0.8) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(251, 113, 133, 0.2);
        border-radius: 20px;
        padding: 0; /* Full Bleed Image */
        overflow: hidden;
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        min-height: 340px;
    }

    .journal-card:hover {
        transform: translateY(-5px);
        border-color: rgba(251, 113, 133, 0.5);
        box-shadow: 0 15px 40px -10px rgba(190, 18, 60, 0.5);
    }

    .journal-card-body {
        padding: 1.2rem;
        display: flex;
        flex-direction: column;
        flex: 1;
    }

    /* Style Badge di Journal */
    .badge-j-prio {
        font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
        border-radius: 20px; padding: 4px 10px;
    }
    .badge-j-stat {
        font-size: 0.75rem; font-weight: 600; 
        border-radius: 6px; padding: 4px 12px; background: rgba(0,0,0,0.3);
    }
    /* --- STYLE DASHBOARD EXTRAS --- */
    .stat-badge {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.2);
        padding: 0.5rem 1rem;
        border-radius: 50px;
        font-size: 0.85rem;
        color: #94a3b8;
        backdrop-filter: blur(5px);
    }
    
    /* Type Badge (Penanda Asal Kartu) */
    .card-source-badge {
        position: absolute;
        top: 10px;
        left: 10px;
        z-index: 10;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.65rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 1px;
        color: white;
        box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        backdrop-filter: blur(4px);
    }
    
    /* Warna Badge per Tipe */
    .badge-src-idea { background: rgba(16, 185, 129, 0.8); }   /* Green */
    .badge-src-plan { background: rgba(139, 92, 246, 0.8); }    /* Purple */
    .badge-src-journal { background: rgba(244, 63, 94, 0.8); }  /* Red/Pink */
    /* --- STYLE NOTULENSI CARD (OCEANIC THEME) --- */
    .notulensi-card {
        /* Gradient Navy/Blue */
        background: linear-gradient(160deg, rgba(15, 23, 42, 0.6) 0%, rgba(30, 58, 138, 0.8) 100%);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(56, 189, 248, 0.2);
        border-radius: 20px;
        padding: 0;
        overflow: hidden;
        position: relative;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        min-height: 340px;
    }
    .notulensi-card:hover {
        transform: translateY(-5px);
        border-color: rgba(56, 189, 248, 0.5);
        box-shadow: 0 15px 40px -10px rgba(29, 78, 216, 0.5);
    }
    .notulensi-card-body {
        padding: 1.2rem;
        display: flex;
        flex-direction: column;
        flex: 1;
    }
    .badge-n-imp {
        font-size: 0.65rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px;
        border-radius: 20px; padding: 4px 10px;
    }
    .badge-n-stat {
        font-size: 0.75rem; font-weight: 600; 
        border-radius: 6px; padding: 4px 12px; background: rgba(0,0,0,0.3);
    }
    /* Warna Badge Source Notulensi di Dashboard */
    .badge-src-notulensi { background: rgba(14, 165, 233, 0.8); } /* Sky Blue */
    /* --- CSS BARU UNTUK DETAIL NOTULENSI --- */
    
    /* Grid Info Utama */
/* --- GRID INFO 3 KOLOM --- */
    .detail-grid-box {
        display: grid; 
        
        /* [REVISI] Mengubah dari 4 kolom (1fr 1fr 1fr 1fr) menjadi 3 kolom */
        grid-template-columns: 1fr 1fr 1fr; 
        
        gap: 1.5rem; 
        background: rgba(15, 23, 42, 0.6); 
        padding: 1.5rem; 
        border-radius: 16px; 
        border: 1px solid rgba(56, 189, 248, 0.2); 
        margin-bottom: 1.5rem;
    }

    /* Responsif: Di layar HP (kecil) jadi 2 kolom atau 1 kolom */
    @media (max-width: 768px) {
        .detail-grid-box { grid-template-columns: 1fr 1fr; }
    }
    @media (max-width: 480px) {
        .detail-grid-box { grid-template-columns: 1fr; }
    }
    .detail-grid-box small { color: #64748b; display: block; margin-bottom: 5px; font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.5px; }
    .text-highlight { color: #38bdf8; font-weight: 600; }
    .text-white { color: #f1f5f9; font-weight: 500; }
    .link-styled { color: #f43f5e; text-decoration: underline; cursor: pointer; }

    /* Content Box (Pembungkus Deskripsi, Agenda, dll) */
    .detail-content-box {
        background: rgba(255, 255, 255, 0.03); /* Background transparan halus */
        border: 1px solid rgba(255, 255, 255, 0.1); /* Border tipis sekeliling */
        border-radius: 12px; /* Sudut tumpul */
        padding: 1.5rem;
        margin-bottom: 1rem;
        transition: 0.3s;
    }
    .detail-content-box:hover {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(56, 189, 248, 0.3);
    }

    /* Khusus Box Keputusan (Sedikit beda biar menonjol) */
    .highlight-box {
        background: rgba(250, 204, 21, 0.05); /* Yellow tint */
        border: 1px solid rgba(250, 204, 21, 0.3);
    }

    .box-label {
        color: #7dd3fc; 
        margin-bottom: 0.8rem; 
        font-size: 0.95rem; 
        display: flex; 
        align-items: center; 
        gap: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    .content-text {
        color: #cbd5e1;
        line-height: 1.7;
        white-space: pre-line; /* Agar enter terbaca */
        text-align: justify;
    }

    /* Badge Styles */
    .badge-pill-stat { padding: 4px 12px; border-radius: 50px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
    .badge-pill-type { padding: 4px 12px; border-radius: 6px; font-size: 0.75rem; font-weight: 600; background: rgba(255,255,255,0.1); color: #cbd5e1; }

    /* Responsif untuk Grid */
    @media (max-width: 768px) {
        .detail-grid-box { grid-template-columns: 1fr 1fr; }
    }
    .modal-box {
        display: flex; flex-direction: column; max-height: 90vh;
        padding: 0 !important; /* INI KUNCINYA */
        overflow: hidden;
    }
    .modal-body {
        padding: 0 1.5rem 1.5rem 1.5rem; /* Padding konten di sini */
        overflow-y: auto; flex: 1;
    }
    .modal-footer {
        width: 100%; padding: 1.2rem 1.5rem; flex-shrink: 0;
        /* ...style lain... */
    }
    </style>
</head>
<body>

   <aside class="sidebar">
        <div class="brand">Life Ways</div>
        <nav>
            <a href="#" class="menu-item" onclick="navigate('dashboard', this)">
                <i class="ph ph-squares-four"></i> Dashboard
            </a>
            
            <a href="#" class="menu-item active" onclick="navigate('ideas', this)">
                <i class="ph ph-lightbulb"></i> Ideas
            </a>
            
            <a href="#" class="menu-item" onclick="navigate('plans', this)">
                <i class="ph ph-calendar-check"></i> Plans
            </a>
            
            <a href="#" class="menu-item" onclick="navigate('journal', this)">
                <i class="ph ph-book-bookmark"></i> Journal
            </a>
            <a href="#" class="menu-item" onclick="navigate('notulensi', this)">
                <i class="ph ph-notebook"></i> Notulensi
            </a>
        </nav>
    </aside>

    <main class="main-content">
        <div id="page-ideas" class="content-section">
        <header class="header">
           <h1 id="greetTitle">Good Morning.</h1>
            <p id="greetDesc">Design your life, your way. Capture your brilliant ideas here.</p>
            
            <div class="actions">
                <div class="actions" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 1rem;">
    
    <button class="btn-primary" onclick="openFormModal()" style="white-space: nowrap;">
        <i class="ph ph-plus-circle" style="font-size: 1.2rem;"></i> New Idea
    </button>

    <div class="search-box-wrapper">
        <i class="ph ph-magnifying-glass search-icon"></i>
        <input type="text" id="inpSearch" placeholder="Cari nama tugas..." oninput="applyFilters()">
    </div>

    <div class="filter-box-wrapper">
        <i class="ph ph-faders filter-icon"></i>
        <select id="inpFilter" onchange="applyFilters()">
            <option value="newest">Waktu: Terbaru (Default)</option>
            <option value="oldest">Waktu: Terlama</option>
            <hr>
            <option value="status_todo">Status: Belum Dimulai</option>
            <option value="status_doing">Status: Dikerjakan</option>
            <option value="status_done">Status: Sudah Selesai</option>
        </select>
    </div>
</div>
            </div>
        </header>

        <div id="ideasContainer" class="cards-grid">
            </div>
     </div>
    <div id="page-dashboard" class="content-section hidden">
            <header class="header">
                <h1 style="background: linear-gradient(to right, #fcd34d, #f87171, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 3rem;">Dashboard Overview.</h1>
                <p style="color:#e2e8f0;">Semua ide, rencana, dan cerita hidupmu dalam satu pandangan.</p>
                
                <div class="actions" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 2rem;">
                     
                     <div class="search-box-wrapper" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2);">
                        <i class="ph ph-magnifying-glass search-icon"></i>
                        <input type="text" id="inpSearchDash" placeholder="Cari di seluruh aplikasi..." oninput="renderDashboard()">
                     </div>

                     <div class="filter-box-wrapper" style="background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.2);">
                        <i class="ph ph-stack filter-icon"></i>
                        <select id="inpDashFilter" onchange="renderDashboard()">
                            <option value="all">Tampilkan Semua</option>
                            <option value="idea">Hanya Ideas (Ide)</option>
                            <option value="plan">Hanya Plans (Rencana)</option>
                            <option value="journal">Hanya Journals (Cerita)</option>
                            <option value="notulensi">Hanya Notulensi (Rapat)</option>
                        </select>
                    </div>
                    <div style="display:flex; gap:1rem; margin-left:auto;">
                        <div class="stat-badge">
                            <span id="statTotal" style="font-weight:bold; color:white;">0</span> Items
                        </div>
                    </div>
                </div>
            </header>

            <div id="dashboardContainer" class="cards-grid">
                </div>
        </div>

        <div id="page-plans" class="content-section hidden">
            <header class="header">
                <h1 style="background: linear-gradient(to right, #a78bfa, #2dd4bf); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Weekly Plans.</h1>
                <p style="color:#cbd5e1;">Rencanakan kesuksesanmu. Susun strategi dan eksekusi.</p>
                
                <div class="actions" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 2rem;">
                     <button class="btn-primary" onclick="openPlanModal()" style="background: linear-gradient(135deg, #6366f1 0%, #a855f7 100%); box-shadow: 0 4px 15px rgba(168, 85, 247, 0.4);">
                        <i class="ph ph-plus-circle"></i> New Plan
                     </button>
                     
                     <div class="search-box-wrapper" style="background: rgba(255,255,255,0.05);">
                        <i class="ph ph-magnifying-glass search-icon"></i>
                        <input type="text" id="inpSearchPlan" placeholder="Cari rencana..." oninput="renderPlans()">
                     </div>
                     

     <div class="filter-box-wrapper" style="background: rgba(255,255,255,0.05);">
        <i class="ph ph-faders filter-icon"></i>
        <select id="inpPlanFilter" onchange="renderPlans()">
            <option value="newest">Waktu: Terbaru</option>
            <option value="oldest">Waktu: Terlama</option>
            <hr>
            <option value="prio_urgent">Prioritas: Urgent & High</option>
            <hr>
            <option value="stat_exec">Status: Eksekusi</option>
            <option value="stat_success">Status: Berhasil</option>
            <option value="stat_idea">Status: Idea / Plan</option>
        </select>
    </div>


                </div>
            </header>

            <div id="plansContainer" class="cards-grid">
                </div>
        </div>

       <div id="page-journal" class="content-section hidden">
            <header class="header">
                <h1 style="background: linear-gradient(to right, #fb7185, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Daily Journal.</h1>
                <p style="color:#fda4af;">Abadikan setiap momen, emosi, dan pencapaian hari ini.</p>
                
                <div class="actions" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 2rem;">
                     <button class="btn-primary" onclick="openJournalModal()" style="background: linear-gradient(135deg, #f43f5e 0%, #fb923c 100%); box-shadow: 0 4px 15px rgba(251, 146, 60, 0.4);">
                        <i class="ph ph-plus-circle"></i> Write Journal
                     </button>
                     
                     <div class="search-box-wrapper" style="background: rgba(255,255,255,0.05);">
                        <i class="ph ph-magnifying-glass search-icon"></i>
                        <input type="text" id="inpSearchJournal" placeholder="Cari cerita..." oninput="renderJournals()">
                     </div>

                     <div class="filter-box-wrapper" style="background: rgba(255,255,255,0.05);">
                        <i class="ph ph-faders filter-icon"></i>
                        <select id="inpJournalFilter" onchange="renderJournals()">
                            <option value="newest">Waktu: Terbaru</option>
                            <option value="oldest">Waktu: Terlama</option>
                            <hr>
                            <option value="imp_very">Sifat: Sangat Penting</option>
                            <option value="imp_yes">Sifat: Penting</option>
                            <hr>
                            <option value="stat_done">Status: Selesai</option>
                            <option value="stat_doing">Status: Dilakukan</option>
                        </select>
                    </div>
                </div>
            </header>

            <div id="journalsContainer" class="cards-grid">
                </div>
        </div>
        <div id="page-notulensi" class="content-section hidden">
            <header class="header">
                <h1 style="background: linear-gradient(to right, #22d3ee, #3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Meeting Minutes.</h1>
                <p style="color:#94a3b8;">Dokumentasikan setiap keputusan dan langkah strategis rapat.</p>
                
                <div class="actions" style="display: flex; flex-wrap: wrap; align-items: center; gap: 1rem; margin-top: 2rem;">
                     <button class="btn-primary" onclick="openNotulensiModal()" style="background: linear-gradient(135deg, #0e7490 0%, #1d4ed8 100%); box-shadow: 0 4px 15px rgba(14, 116, 144, 0.4);">
                        <i class="ph ph-plus-circle"></i> New Note
                     </button>
                     
                     <div class="search-box-wrapper" style="background: rgba(255,255,255,0.05);">
                        <i class="ph ph-magnifying-glass search-icon"></i>
                        <input type="text" id="inpSearchNotulensi" placeholder="Cari notulensi..." oninput="renderNotulensi()">
                     </div>

                     <div class="filter-box-wrapper" style="background: rgba(255,255,255,0.05);">
                        <i class="ph ph-faders filter-icon"></i>
                        <select id="inpNotulensiFilter" onchange="renderNotulensi()">
                            <option value="newest">Waktu: Terbaru</option>
                            <option value="oldest">Waktu: Terlama</option>
                            <hr>
                            <option value="imp_very">Penting: Sangat Penting</option>
                            <option value="stat_done">Status: Selesai</option>
                            <option value="stat_progress">Status: Berlangsung</option>
                            <option value="type_internal">Jenis: Internal</option>
                            <option value="type_external">Jenis: Eksternal</option>
                        </select>
                    </div>
                </div>
            </header>

            <div id="notulensiContainer" class="cards-grid"></div>
        </div>
    </main>

    <div class="modal-overlay" id="modalOverlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 id="modalTitle">New Idea</h3>
                <button class="btn-icon" onclick="closeModal()"><i class="ph ph-x"></i></button>
            </div>

        <div class="modal-body">
    <form id="ideaForm">
        <input type="hidden" id="ideaId"> 

        <h4 style="margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Core Information</h4>
        
        <div class="form-group">
            <label>Judul Ide / Tugas</label>
            <input type="text" id="inpTitle" placeholder="Contoh: Redesign UI Dashboard Life Ways" required>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Kategori (50+ Pilihan)</label>
                <select id="inpCategory"></select>
            </div>
            <div class="form-group">
                <label>Kategori Tugas</label>
                <select id="inpTeamCat">
                    <option value="Individu">Individu</option>
                    <option value="Kelompok">Kelompok</option>
                    <option value="Organisasi">Organisasi</option>
                </select>
            </div>
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Status Pengerjaan</label>
                <select id="inpStatus">
                    <option value="Belum Dimulai">Belum Dimulai</option>
                    <option value="Dikerjakan">Sedang Dikerjakan</option>
                    <option value="Sudah Selesai">Sudah Selesai</option>
                    <option value="Pending">Pending</option>
                </select>
            </div>
            <div class="form-group">
                <label>Sifat Tugas</label>
                <select id="inpImportance">
                    <option value="Tidak Penting">Tidak Penting</option>
                    <option value="Penting">Penting</option>
                    <option value="Sangat Penting">Sangat Penting</option>
                    <option value="Urgent">Urgent / Mendesak</option>
                </select>
            </div>
        </div>

        <h4 style="margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Timeline & Location</h4>
        
        <div class="form-row">
            <div class="form-group">
        <label>Start Date</label>
        <input type="date" id="inpStartDate" required>
    </div>
    <div class="form-group">
        <label>Start Time (Jam:Mnt:Dtk)</label>
        <input type="time" step="1" id="inpStartTime" required> 
    </div>
            <div class="form-group">
                <label>Zona Waktu</label>
                <select id="inpTimezone">
                    <option value="WIB">WIB (Indonesia Barat)</option>
                    <option value="WITA">WITA (Indonesia Tengah)</option>
                    <option value="WIT">WIT (Indonesia Timur)</option>
                </select>
            </div>
        </div>

        <h4 style="margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Technical Details</h4>

        <div class="form-row">
            <div class="form-group">
                <label>Jenis Tugas (Teks)</label>
                <input type="text" id="inpTaskType" placeholder="Misal: Coding, Research, Design">
            </div>
            <div class="form-group">
                <label>Media Pengerjaan</label>
                <input type="text" id="inpMedium" placeholder="Misal: Figma, VS Code, Google Docs">
            </div>
        </div>
<div class="form-row">
    <div class="form-group">
        <label>End Date</label>
        <input type="date" id="inpEndDate" required>
    </div>
    <div class="form-group">
        <label>End Time (Jam:Mnt:Dtk)</label>
        <input type="time" step="1" id="inpEndTime" required>
    </div>
</div>

<div class="form-row">
    <div class="form-group">
        <label>Pemilik Tugas (Owner)</label>
        <input type="text" id="inpOwner" placeholder="Nama Penanggung Jawab">
    </div>
    <div class="form-group">
        <label>Time Spent (Aktual)</label>
        <input type="text" id="inpTimeSpent" placeholder="Misal: 5 Jam 30 Menit">
    </div>
</div>

<div class="form-group">
    <label>Progress Penyelesaian (%)</label>
    <div style="display:flex; align-items:center; gap:10px;">
        <input type="range" id="inpProgressRange" min="0" max="100" value="0" oninput="document.getElementById('progressVal').innerText = this.value + '%'" style="flex:1;">
        <span id="progressVal" style="width:50px; text-align:right; font-weight:bold;">0%</span>
    </div>
</div>

<h4 style="margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Work Stages</h4>
<div class="form-group" style="background: rgba(0,0,0,0.2); padding:1rem; border-radius:10px;">
    <label>Jumlah Stage yang dibutuhkan:</label>
    <div style="display:flex; gap:10px; margin-bottom:1rem;">
        <input type="number" id="inpStageCount" placeholder="0" style="width:80px;">
        <button type="button" onclick="generateStages()" style="background:var(--primary-grad); border:none; color:white; padding:0 1rem; border-radius:8px; cursor:pointer;">Buat Stage</button>
    </div>
    
    <div id="stageContainer" style="display:flex; flex-direction:column; gap:1rem;"></div>
</div>
        <div class="form-group">
            <label>Link Dokumentasi</label>
            <input type="url" id="inpDocLink" placeholder="https://docs.google.com/...">
        </div>

        <div class="form-group">
            <label>Deskripsi Lengkap</label>
            <textarea id="inpDesc" placeholder="Jelaskan detail tugas di sini..." style="height: 100px;"></textarea>
        </div>

        <div class="form-group">
            <label>Catatan Khusus</label>
            <textarea id="inpNotes" placeholder="Catatan tambahan (notes)..." style="height: 80px;"></textarea>
        </div>

        <h4 style="margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Visual & Extras</h4>

        <div class="form-group">
            <label>Cover Image (Opsional)</label>
            <input type="url" id="inpImg" placeholder="Link gambar custom (kosongkan untuk auto-image dari kategori)">
            <small style="color:var(--text-muted); font-size: 0.75rem;">Jika kosong, gambar akan otomatis menyesuaikan kategori yang dipilih.</small>
        </div>

        
       <h4 style="margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem; color:#2dd4bf;">Informasi Tambahan (Opsional)</h4>
        
        <div class="form-group" style="background: rgba(0,0,0,0.2); padding:1rem; border-radius:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                <label style="margin:0;">Jumlah Data Tambahan:</label>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="inpCustomCount" placeholder="Jml" style="width:60px; text-align:center;">
                    <button type="button" onclick="generateCustomFields()" style="background:var(--primary-grad); border:none; color:white; padding:0.4rem 1rem; border-radius:6px; cursor:pointer; font-size:0.8rem;">+ Buat Form</button>
                </div>
            </div>
            
            <div id="customFieldsContainer" style="display:flex; flex-direction:column; gap:1rem;"></div>
        </div>
    </form>

    <div id="detailView" class="hidden detail-view">
      <img id="viewImg" src="" class="detail-img" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&w=800&q=80';">  
        <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem;">
            <div>
                <h2 id="viewTitle" style="color:white; line-height:1.2;"></h2>
                <div style="margin-top:0.5rem; display:flex; gap:0.5rem; flex-wrap:wrap;">
                    <span id="viewCategoryBadge" style="background:var(--primary-grad); padding:4px 12px; border-radius:20px; font-size:0.8rem; font-weight:600;"></span>
                    <span id="viewStatusBadge" style="background:rgba(255,255,255,0.2); padding:4px 12px; border-radius:20px; font-size:0.8rem;"></span>
                    <span id="viewTeamBadge" style="border:1px solid rgba(255,255,255,0.3); padding:4px 12px; border-radius:20px; font-size:0.8rem;"></span>
                </div>
            </div>
            <div style="text-align:right;">
                <div id="viewImportance" style="color:#f59e0b; font-weight:700; text-transform:uppercase; font-size:0.9rem;"></div>
                <div id="viewTimezone" style="color:var(--text-muted); font-size:0.8rem;"></div>
            </div>
        </div>
        <div style="font-size:0.8rem; color:var(--text-muted); margin-bottom:1rem; display:flex; gap:1.5rem; border-bottom:1px dashed rgba(255,255,255,0.1); padding-bottom:1rem;">
    <span><i class="ph ph-user"></i> Owner: <b id="viewOwner" style="color:white;">-</b></span>
    <span><i class="ph ph-clock"></i> Created: <span id="viewCreated"></span></span>
    <span><i class="ph ph-pencil-simple"></i> Last Update: <span id="viewUpdated"></span></span>
</div>

<div style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:12px; margin-bottom:1.5rem;">
    <div style="display:flex; justify-content:space-between; margin-bottom:0.5rem;">
        <small>Estimasi Durasi: <b id="viewDuration" style="color:#2dd4bf;">-</b></small>
        <small>Time Spent: <b id="viewTimeSpent">-</b></small>
    </div>
    
    <div style="height:10px; width:100%; background:rgba(0,0,0,0.3); border-radius:10px; overflow:hidden;">
        <div id="viewProgressBar" style="height:100%; background:var(--primary-grad); width:0%; transition:width 0.5s;"></div>
    </div>
    <div style="text-align:right; font-size:0.8rem; margin-top:4px;" id="viewProgressText">0% Completed</div>
</div>

<h4 style="color:#2dd4bf; margin-bottom:0.5rem;">Work Stages</h4>
<div id="viewStagesList" style="margin-bottom:1.5rem; display:flex; flex-direction:column; gap:10px;">
    </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem; background:rgba(0,0,0,0.2); padding:1.5rem; border-radius:16px; margin-bottom:1.5rem;">
            <div>
                <small style="color:var(--text-muted);">Start Date</small>
                <div id="viewStartDate" style="font-weight:500;"></div>
            </div>
            <div>
                <small style="color:var(--text-muted);">End Date</small>
                <div id="viewEndDate" style="font-weight:500;"></div>
            </div>
            <div>
                <small style="color:var(--text-muted);">Jenis Tugas</small>
                <div id="viewTaskType"></div>
            </div>
            <div>
                <small style="color:var(--text-muted);">Media</small>
                <div id="viewMedium"></div>
            </div>
        </div>

        <h4 style="color:#2dd4bf; margin-bottom:0.5rem;">Description</h4>
        <p id="viewDesc" class="detail-content" style="margin-bottom:1.5rem;"></p>

        <h4 style="color:#2dd4bf; margin-bottom:0.5rem;">Notes</h4>
        <p id="viewNotes" style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:10px; font-style:italic; color:#e0e7ff; margin-bottom:1.5rem;"></p>

    <div style="border-top:1px solid rgba(255,255,255,0.1); padding-top:1rem; margin-top:1.5rem;">
            <h4 style="color:#2dd4bf; margin-bottom:1rem;">Additional Information</h4>
            
            <div id="viewCustomFields" style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem; font-size:0.9rem;">
                </div>
        </div>
        
        <div style="margin-top:1.5rem;">
            <a id="viewDocLink" href="#" target="_blank" style="color:#2dd4bf; text-decoration:none; display:flex; align-items:center; gap:5px;">
                <i class="ph ph-link"></i> Buka Link Dokumentasi
            </a>
        </div>
    </div>
</div>
            <div class="modal-footer">
                <div id="formActions">
                    <button type="button" class="btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="button" class="btn-save" onclick="saveIdea()">Save Idea</button>
                </div>
                <div id="detailActions" class="hidden">
                    <button type="button" class="btn-cancel" onclick="switchToEditMode()">Edit Content</button>
                    <button type="button" class="btn-save" onclick="closeModal()">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="planModalOverlay">
        <div class="modal-box" style="background: linear-gradient(145deg, #1e1b4b, #312e81); border: 1px solid rgba(167, 139, 250, 0.2);">
            <div class="modal-header">
                <h3 id="planModalTitle" style="color: #a78bfa;">New Plan</h3>
                <button class="btn-icon" onclick="closePlanModal()"><i class="ph ph-x"></i></button>
            </div>

            <div class="modal-body">
               <form id="planForm">
    <input type="hidden" id="planId">
    
    <h4 style="color:#a78bfa; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Core Plan Info</h4>
    <div class="form-group">
        <label>Nama Rencana</label>
        <input type="text" id="inpPlanTitle" placeholder="Misal: Launching Q1" required>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label>Kategori Perencanaan (50+ Opsi)</label>
            <select id="inpPlanCategory"></select> </div>
        <div class="form-group">
            <label>Status Plan</label>
            <select id="inpPlanStatus">
                <option value="Idea">Idea (Ide Awal)</option>
                <option value="Plan">Plan (Perencanaan)</option>
                <option value="Eksekusi">Eksekusi (Sedang Jalan)</option>
                <option value="Berhasil">Berhasil (Selesai)</option>
            </select>
        </div>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Time & Technical</h4>
    <div class="form-row">
        <div class="form-group">
            <label>Start Date</label>
            <input type="date" id="inpPlanStart">
        </div>
        <div class="form-group">
            <label>Start Time</label>
            <input type="time" step="1" id="inpPlanStartTime">
        </div>
    </div>
    <div class="form-row">
        <div class="form-group">
            <label>End Date</label>
            <input type="date" id="inpPlanEnd">
        </div>
        <div class="form-group">
            <label>End Time</label>
            <input type="time" step="1" id="inpPlanEndTime">
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group"><label>Owner</label><input type="text" id="inpPlanOwner"></div>
        <div class="form-group">
            <label>Prioritas</label>
            <select id="inpPlanPriority">
                <option value="Low">Low</option>
                <option value="Medium" selected>Medium</option>
                <option value="High">High</option>
                <option value="Urgent">Urgent</option>
            </select>
        </div>
    </div>
    <div class="form-row">
        <div class="form-group"><label>Kategori Anggota</label><select id="inpPlanTeam"><option>Individu</option><option>Tim</option></select></div>
        <div class="form-group"><label>Media Perencanaan</label><input type="text" id="inpPlanMedia" placeholder="Trello, Notion..."></div>
    </div>
    <div class="form-group"><label>Jenis Perencanaan</label><input type="text" id="inpPlanType" placeholder="Strategis, Operasional..."></div>
    
    <div class="form-group">
        <label>Deskripsi Rencana</label>
        <textarea id="inpPlanDesc" placeholder="Jelaskan rencana secara umum..." style="height:80px;"></textarea>
    </div>
    
    <div class="form-group">
        <label>Catatan Tambahan</label>
        <textarea id="inpPlanNotes" style="height:60px;"></textarea>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Goals (Target)</h4>
    <div class="dynamic-group" id="containerGoals">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countGoals" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('Goals')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperGoals" class="dynamic-wrapper"></div>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Impacts</h4>
    <div class="dynamic-group" id="containerImpacts">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countImpacts" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('Impacts')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperImpacts" class="dynamic-wrapper"></div>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Risks (Hambatan)</h4>
    <div class="dynamic-group" id="containerRisks">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countRisks" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('Risks')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperRisks" class="dynamic-wrapper"></div>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Mitigation</h4>
    <div class="dynamic-group" id="containerMitigation">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countMitigation" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('Mitigation')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperMitigation" class="dynamic-wrapper"></div>
    </div>

    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Sub-Tugas (Detailed Tasks)</h4>
    <div class="dynamic-group" id="containerSubTasks">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countSubTasks" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('SubTasks')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperSubTasks" class="dynamic-wrapper"></div>
    </div>
    
    <h4 style="color:#a78bfa; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Milestones</h4>
    <div class="dynamic-group" id="containerMilestones">
        <div style="display:flex; gap:10px; margin-bottom:10px;">
            <input type="number" id="countMilestones" placeholder="Jml" style="width:60px;">
            <button type="button" onclick="generateDynamicField('Milestones')" class="btn-gen-purple">+ Buat</button>
        </div>
        <div id="wrapperMilestones" class="dynamic-wrapper"></div>
    </div>
</form>

                <div id="planDetailView" class="hidden detail-view">
                   <div style="width: 100%; height: 220px; border-radius: 16px; overflow: hidden; margin-bottom: 1.5rem; border: 1px solid rgba(167, 139, 250, 0.3); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.3); background:#1e1b4b;">
        <img id="viewPlanCover" 
             src="" 
             style="width: 100%; height: 100%; object-fit: cover;" 
             onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1460925895917-afdab827c52f?w=800&q=80';">
    </div>
    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem; border-bottom:1px solid rgba(167, 139, 250, 0.2); padding-bottom:1rem;">
        <div>
            <span id="viewPlanStatusBadge" style="font-size:0.75rem; font-weight:700; text-transform:uppercase; padding:4px 12px; border-radius:20px;"></span>
            <h2 id="viewPlanTitle" style="margin-top:0.8rem; font-size:1.8rem; line-height:1.2; background: linear-gradient(to right, #fff, #c4b5fd); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></h2>
            <div id="viewPlanCategory" style="color:#a78bfa; font-size:0.9rem; margin-top:0.3rem; letter-spacing:0.5px; text-transform:uppercase;"></div>
        </div>
        <div style="text-align:right;">
             <div id="viewPlanPriority" style="font-weight:700; color:#f87171; letter-spacing:1px; text-transform:uppercase;"></div>
        </div>
    </div>

    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem; background:rgba(255,255,255,0.03); padding:1.2rem; border-radius:12px; border:1px solid rgba(167, 139, 250, 0.1); margin-bottom:1.5rem;">
        <div><small style="color:#64748b;">Owner</small><div id="viewPlanOwner" style="color:white;"></div></div>
        <div><small style="color:#64748b;">Team Type</small><div id="viewPlanTeam" style="color:white;"></div></div>
        <div><small style="color:#64748b;">Plan Type</small><div id="viewPlanType" style="color:white;"></div></div>
        <div><small style="color:#64748b;">Media</small><div id="viewPlanMedia" style="color:white;"></div></div>
        <div><small style="color:#64748b;">Start</small><div id="viewPlanStart" style="color:#a78bfa;"></div></div>
        <div><small style="color:#64748b;">End</small><div id="viewPlanEnd" style="color:#a78bfa;"></div></div>
    </div>

    <h4 style="color:#a78bfa; margin-bottom:0.5rem;">Description</h4>
    <p id="viewPlanDesc" style="color:#cbd5e1; line-height:1.6; text-align:justify; margin-bottom:1.5rem; white-space:pre-line;"></p>

    <h4 style="color:#a78bfa; margin-bottom:0.5rem;">Notes</h4>
    <div id="viewPlanNotes" style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:8px; color:#cbd5e1; font-style:italic; margin-bottom:2rem;"></div>

    <h4 class="section-title-plan">Goals (Target)</h4>
    <div id="viewListGoals" class="dynamic-list-container"></div>

    <h4 class="section-title-plan">Impacts</h4>
    <div id="viewListImpacts" class="dynamic-list-container"></div>

    <h4 class="section-title-plan">Risks (Hambatan)</h4>
    <div id="viewListRisks" class="dynamic-list-container"></div>

    <h4 class="section-title-plan">Mitigation</h4>
    <div id="viewListMitigation" class="dynamic-list-container"></div>

    <h4 class="section-title-plan">Sub-Tasks & Progress</h4>
    <div id="viewListSubTasks" class="dynamic-list-container"></div>

    <h4 class="section-title-plan">Milestones</h4>
    <div id="viewListMilestones" class="dynamic-list-container"></div>

</div>

<style>
    /* CSS Tambahan Khusus Detail Plan */
    .section-title-plan { color: #a78bfa; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 1px dashed rgba(167,139,250,0.3); padding-bottom: 0.5rem; }
    .dynamic-list-container { display: flex; flex-direction: column; gap: 1rem; }
</style>
            </div>

            <div class="modal-footer" style="border-top-color: rgba(167, 139, 250, 0.2);">
                <div id="planFormActions">
                    <button type="button" class="btn-cancel" onclick="closePlanModal()">Cancel</button>
                    <button type="button" class="btn-save" onclick="savePlan()" style="background: linear-gradient(135deg, #6366f1, #a855f7);">Save Plan</button>
                </div>
                <div id="planDetailActions" class="hidden">
                    <button type="button" class="btn-cancel" onclick="editPlan()">Edit Plan</button>
                    <button type="button" class="btn-save" onclick="closePlanModal()" style="background: linear-gradient(135deg, #6366f1, #a855f7);">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="journalModalOverlay">
        <div class="modal-box" style="background: linear-gradient(145deg, #450a0a, #7f1d1d); border: 1px solid rgba(251, 113, 133, 0.2);">
            <div class="modal-header">
                <h3 id="journalModalTitle" style="color: #fda4af;">New Journal Entry</h3>
                <button class="btn-icon" onclick="closeJournalModal()"><i class="ph ph-x"></i></button>
            </div>

            <div class="modal-body">
                <form id="journalForm">
                    <input type="hidden" id="journalId">
                    
                    <h4 style="color:#fda4af; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Header Info</h4>
                    <div class="form-group">
                        <label>Judul Daily Journal</label>
                        <input type="text" id="inpJTitle" placeholder="Judul cerita hari ini..." required>
                    </div>

                    <div class="form-row">
                        <div class="form-group"><label>Nama Pemilik</label><input type="text" id="inpJOwner"></div>
                        <div class="form-group">
                            <label>Kategori (20 Pilihan)</label>
                            <select id="inpJCategory"></select> </div>
                    </div>

                    <h4 style="color:#fda4af; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Waktu & Status</h4>
                    <div class="form-row">
                        <div class="form-group"><label>Tanggal</label><input type="date" id="inpJDate"></div>
                        <div class="form-group"><label>Jam (Detik)</label><input type="time" step="1" id="inpJTime"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Kategori Tim</label>
                            <select id="inpJTeam"><option>Individu</option><option>Kelompok</option></select>
                        </div>
                        <div class="form-group">
                            <label>Status Journal</label>
                            <select id="inpJStatus">
                                <option value="Belum Dimulai">Belum Dimulai</option>
                                <option value="Dilakukan">Dilakukan</option>
                                <option value="Selesai">Selesai</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Sifat / Urgensi</label>
                        <select id="inpJPriority">
                            <option value="Sangat Penting">Sangat Penting</option>
                            <option value="Penting" selected>Penting</option>
                            <option value="Tidak Penting">Tidak Penting</option>
                        </select>
                    </div>

                    <h4 style="color:#fda4af; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Konten & Media</h4>
                    <div class="form-row">
                        <div class="form-group"><label>Media Journal</label><input type="text" id="inpJMedia" placeholder="Teks, Video, dll"></div>
                        <div class="form-group"><label>Link Dokumentasi</label><input type="text" id="inpJLink" placeholder="https://..."></div>
                    </div>
                    <div class="form-group">
                        <label>Deskripsi Daily Journal</label>
                        <textarea id="inpJDesc" placeholder="Tulis ceritamu di sini..." style="height:100px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Catatan Tambahan</label>
                        <textarea id="inpJNotes" style="height:60px;"></textarea>
                    </div>

                    <h4 style="color:#fda4af; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Sub Daily Journal (Aktivitas)</h4>
                    <div class="dynamic-group" id="containerSubJournal">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input type="number" id="countSubJournal" placeholder="Jml" style="width:60px;">
                            <button type="button" onclick="generateSubJournalFields()" style="background: linear-gradient(135deg, #f43f5e, #fb923c); border:none; color:white; padding:0.4rem 1rem; border-radius:6px; cursor:pointer;">+ Generate</button>
                        </div>
                        <div id="wrapperSubJournal" class="dynamic-wrapper"></div>
                    </div>
                </form>

                <div id="journalDetailView" class="hidden detail-view">
                    <div style="width:100%; height:220px; border-radius:16px; overflow:hidden; margin-bottom:1.5rem; border:1px solid rgba(251,113,133,0.3); box-shadow:0 10px 30px -10px rgba(0,0,0,0.4); background:#450a0a;">
                        <img id="viewJCover" src="" style="width:100%; height:100%; object-fit:cover;" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80';">
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; border-bottom:1px solid rgba(251,113,133,0.2); padding-bottom:1rem;">
                        <div>
                            <span id="viewJStatusBadge"></span>
                            <h2 id="viewJTitle" style="margin-top:0.8rem; font-size:1.8rem; line-height:1.2; background: linear-gradient(to right, #fff, #fda4af); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></h2>
                            <div id="viewJCategory" style="color:#fb7185; font-size:0.9rem; margin-top:0.3rem; letter-spacing:0.5px; text-transform:uppercase;"></div>
                        </div>
                        <div style="text-align:right;">
                             <div id="viewJPriority" style="font-weight:700; color:#fb923c; letter-spacing:1px; text-transform:uppercase;"></div>
                        </div>
                    </div>

                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:1.2rem; background:rgba(255,255,255,0.03); padding:1.2rem; border-radius:12px; border:1px solid rgba(251,113,133,0.1); margin-bottom:1.5rem;">
                        <div><small style="color:#9ca3af;">Owner</small><div id="viewJOwner" style="color:white;"></div></div>
                        <div><small style="color:#9ca3af;">Tim</small><div id="viewJTeam" style="color:white;"></div></div>
                        <div><small style="color:#9ca3af;">Media</small><div id="viewJMedia" style="color:white;"></div></div>
                        <div><small style="color:#9ca3af;">Link</small><a id="viewJLink" href="#" target="_blank" style="color:#fb7185;">Buka Link</a></div>
                        <div><small style="color:#9ca3af;">Date</small><div id="viewJDate" style="color:#fda4af;"></div></div>
                        <div><small style="color:#9ca3af;">Time</small><div id="viewJTime" style="color:#fda4af;"></div></div>
                    </div>

                    <h4 style="color:#fb7185; margin-bottom:0.5rem;">Story Description</h4>
                    <p id="viewJDesc" style="color:#e5e7eb; line-height:1.6; text-align:justify; margin-bottom:1.5rem; white-space:pre-line;"></p>

                    <h4 style="color:#fb7185; margin-bottom:0.5rem;">Notes</h4>
                    <div id="viewJNotes" style="background:rgba(255,255,255,0.05); padding:1rem; border-radius:8px; color:#d1d5db; font-style:italic; margin-bottom:2rem;"></div>

                    <h4 style="color:#fb7185; margin-bottom:1rem; border-bottom:1px dashed rgba(251,113,133,0.3); padding-bottom:0.5rem;">Sub Daily Journals (Aktivitas)</h4>
                    <div id="viewListSubJournal" style="display:flex; flex-direction:column; gap:1rem;"></div>
                </div>
            </div>

            <div class="modal-footer" style="border-top-color: rgba(251, 113, 133, 0.2);">
                <div id="journalFormActions">
                    <button type="button" class="btn-cancel" onclick="closeJournalModal()">Cancel</button>
                    <button type="button" class="btn-save" onclick="saveJournal()" style="background: linear-gradient(135deg, #f43f5e, #fb923c);">Save Journal</button>
                </div>
                <div id="journalDetailActions" class="hidden">
                    <button type="button" class="btn-cancel" onclick="editJournal()">Edit</button>
                    <button type="button" class="btn-save" onclick="closeJournalModal()" style="background: linear-gradient(135deg, #f43f5e, #fb923c);">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="notulensiModalOverlay">
        <div class="modal-box" style="background: linear-gradient(145deg, #0f172a, #1e3a8a); border: 1px solid rgba(56, 189, 248, 0.2); max-width: 800px;">
            <div class="modal-header">
                <h3 id="notulensiModalTitle" style="color: #38bdf8;">New Meeting Note</h3>
                <button class="btn-icon" onclick="closeNotulensiModal()"><i class="ph ph-x"></i></button>
            </div>

            <div class="modal-body">
                <form id="notulensiForm">
                    <input type="hidden" id="notulensiId">
                    
                    <h4 style="color:#38bdf8; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">General Info</h4>
                    <div class="form-group">
                        <label>Judul Rapat</label>
                        <input type="text" id="inpNTitle" placeholder="Contoh: Evaluasi Q1 Marketing" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Jenis Rapat</label>
                            <select id="inpNType">
                                <option>Internal</option><option>Eksternal</option><option>Koordinasi</option><option>Evaluasi</option>
                                <option>Brainstorming</option><option>Briefing</option><option>Board Meeting</option><option>Darurat</option>
                                <option>Project Kickoff</option><option>Weekly Sync</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Kategori (Divisi)</label>
                            <select id="inpNCategory"></select> </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Tipe Peserta</label><select id="inpNGroupType"><option>Kelompok</option><option>Individu</option></select></div>
                        <div class="form-group"><label>Sifat Rapat</label><select id="inpNNature"><option>Formal</option><option>Non-Formal</option></select></div>
                        <div class="form-group"><label>Tingkat Kepentingan</label><select id="inpNImportance"><option>Penting</option><option>Sangat Penting</option><option>Tidak Penting</option></select></div>
                    </div>

                    <h4 style="color:#38bdf8; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">People</h4>
                    <div class="form-row">
                        <div class="form-group"><label>Nama Notulis</label><input type="text" id="inpNNotulis"></div>
                        <div class="form-group"><label>Pimpinan Rapat</label><input type="text" id="inpNLeader"></div>
                    </div>
                    <div class="form-group">
                        <label>Daftar Peserta (Pisahkan koma)</label>
                        <input type="text" id="inpNParticipants" placeholder="Budi, Ani, Siti...">
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Total Peserta</label><input type="number" id="inpNCount" placeholder="0"></div>
                        <div class="form-group"><label>Status Notulensi</label><select id="inpNStatus"><option>Selesai</option><option>Berlangsung</option><option>Belum Dimulai</option></select></div>
                    </div>

                    <h4 style="color:#38bdf8; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Time & Place</h4>
                    <div class="form-row">
                        <div class="form-group"><label>Tanggal Rapat</label><input type="date" id="inpNDate"></div>
                        <div class="form-group"><label>Mulai</label><input type="time" step="1" id="inpNStart"></div>
                        <div class="form-group"><label>Selesai</label><input type="time" step="1" id="inpNEnd"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Media</label><select id="inpNMedia"><option>Offline</option><option>Zoom</option><option>GMeet</option><option>Teams</option></select></div>
                        <div class="form-group"><label>Lokasi / Platform Link</label><input type="text" id="inpNLocation"></div>
                    </div>
                    <div class="form-group"><label>Link Dokumentasi (Drive/Rec)</label><input type="text" id="inpNDocLink"></div>

                    <h4 style="color:#38bdf8; margin-top:1.5rem; margin-bottom:1rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Content</h4>
                    <div class="form-group"><label>Deskripsi Singkat</label><textarea id="inpNDesc" style="height:60px;"></textarea></div>
                    <div class="form-group"><label>Agenda Rapat</label><textarea id="inpNAgenda" placeholder="Poin-poin agenda..." style="height:80px;"></textarea></div>
                    <div class="form-group"><label>Hasil Pembahasan</label><textarea id="inpNResult" style="height:100px;"></textarea></div>
                    <div class="form-group"><label>Keputusan (Decision)</label><textarea id="inpNDecision" style="height:80px; border-color:#38bdf8;"></textarea></div>
                    <div class="form-group"><label>Catatan Tambahan</label><textarea id="inpNNotes" style="height:60px;"></textarea></div>

                    <h4 style="color:#38bdf8; margin-top:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); padding-bottom:0.5rem;">Action Items (Tindak Lanjut)</h4>
                    <div class="dynamic-group" id="containerActionItems">
                        <div style="display:flex; gap:10px; margin-bottom:10px;">
                            <input type="number" id="countActionItems" placeholder="Jml" style="width:60px;">
                            <button type="button" onclick="generateActionFields()" style="background: linear-gradient(135deg, #0ea5e9, #2563eb); border:none; color:white; padding:0.4rem 1rem; border-radius:6px; cursor:pointer;">+ Add Item</button>
                        </div>
                        <div id="wrapperActionItems" class="dynamic-wrapper"></div>
                    </div>
                </form>

             <div id="notulensiDetailView" class="hidden detail-view">
                    
                    <div style="width:100%; height:220px; border-radius:16px; overflow:hidden; margin-bottom:1.5rem; border:1px solid rgba(56,189,248,0.3); background:#0f172a; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);">
                        <img id="viewNCover" src="" style="width:100%; height:100%; object-fit:cover;">
                    </div>

                    <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1.5rem; border-bottom:1px solid rgba(56,189,248,0.2); padding-bottom:1rem;">
                        <div style="flex:1;">
                            <div style="display:flex; gap:10px; margin-bottom:0.5rem;">
                                <span id="viewNStatusBadge"></span>
                                <span id="viewNTypeBadge"></span>
                            </div>
                            <h2 id="viewNTitle" style="margin-top:0.5rem; font-size:1.8rem; line-height:1.2; background: linear-gradient(to right, #fff, #7dd3fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></h2>
                            <div style="display:flex; gap:10px; align-items:center; margin-top:0.5rem;">
                                <span id="viewNCategory" style="color:#38bdf8; font-size:0.9rem; font-weight:700; letter-spacing:0.5px; text-transform:uppercase;"></span>
                                <span style="color:#64748b;"></span>
                                <span id="viewNNature" style="color:#94a3b8; font-size:0.9rem;"></span>
                            </div>
                        </div>
                        <div style="text-align:right;">
                             <div id="viewNImportance" style="font-weight:800; color:#facc15; letter-spacing:1px; text-transform:uppercase; font-size:1.2rem;"></div>
                             <div style="font-size:0.75rem; color:#64748b; margin-top:5px;">PRIORITY</div>
                        </div>
                    </div>

                    <div class="detail-grid-box">
                        <div><small>Tanggal Rapat</small><div id="viewNDate" class="text-highlight"></div></div>
                        <div><small>Waktu (Durasi)</small><div id="viewNTime" class="text-highlight"></div></div>
                        <div><small>Lokasi / Media</small><div id="viewNLoc" class="text-white"></div></div>
                        <div><small>Link Dokumen</small><a id="viewNDoc" href="#" target="_blank" class="link-styled">Buka Link</a></div>
                        
                        <div><small>Pimpinan Rapat</small><div id="viewNLeader" class="text-white"></div></div>
                        <div><small>Notulis</small><div id="viewNNotulis" class="text-white"></div></div>
                        <div><small>Total Peserta</small><div id="viewNCount" class="text-white"></div></div>
                        <div><small>Tipe Peserta</small><div id="viewNGroup" class="text-white"></div></div>
                    </div>

                    <div class="detail-content-box">
                        <h4 class="box-label"><i class="ph ph-users"></i> Daftar Peserta</h4>
                        <p id="viewNParticipants" style="color:#e2e8f0; line-height:1.6;"></p>
                    </div>

                    <div class="detail-content-box">
                        <h4 class="box-label"><i class="ph ph-text-align-left"></i> Deskripsi Singkat</h4>
                        <p id="viewNDesc" class="content-text"></p>
                    </div>

                    <div class="detail-content-box">
                        <h4 class="box-label"><i class="ph ph-list-numbers"></i> Agenda Rapat</h4>
                        <p id="viewNAgenda" class="content-text"></p>
                    </div>

                    <div class="detail-content-box">
                        <h4 class="box-label"><i class="ph ph-chats-circle"></i> Hasil Pembahasan</h4>
                        <p id="viewNResult" class="content-text"></p>
                    </div>

                    <div class="detail-content-box highlight-box">
                        <h4 class="box-label" style="color:#facc15;"><i class="ph ph-gavel"></i> Keputusan (Decision)</h4>
                        <p id="viewNDecision" class="content-text" style="color:#fff; font-weight:500;"></p>
                    </div>

                    <div class="detail-content-box">
                        <h4 class="box-label"><i class="ph ph-note"></i> Catatan Tambahan</h4>
                        <p id="viewNNotes" class="content-text" style="font-style:italic; color:#94a3b8;"></p>
                    </div>

                    <h4 style="color:#38bdf8; margin-top:2rem; margin-bottom:1rem; display:flex; align-items:center; gap:10px;">
                        <i class="ph ph-check-square"></i> Action Items / Tindak Lanjut
                    </h4>
                    <div id="viewListActionItems" style="display:flex; flex-direction:column; gap:1rem;"></div>
                
            </div>
             </div>
    

            <div class="modal-footer" style="border-top-color: rgba(56, 189, 248, 0.2);">
                <div id="notulensiFormActions">
                    <button type="button" class="btn-cancel" onclick="closeNotulensiModal()">Cancel</button>
                    <button type="button" class="btn-save" onclick="saveNotulensi()" style="background: linear-gradient(135deg, #0ea5e9, #2563eb);">Save Note</button>
                </div>
                <div id="notulensiDetailActions" class="hidden">
                    <button type="button" class="btn-cancel" onclick="editNotulensi()">Edit</button>
                    <button type="button" class="btn-save" onclick="closeNotulensiModal()" style="background: linear-gradient(135deg, #0ea5e9, #2563eb);">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // --- 1. SETUP DATA KATEGORI (50 item) ---

    const categoryAssets = {
        // Business & Work
        "Work": "https://images.unsplash.com/photo-1497215728101-856f4ea42174?auto=format&fit=crop&w=800&q=80",
        "Finance": "https://images.unsplash.com/photo-1554224155-984063584d45?auto=format&fit=crop&w=800&q=80",
        "Marketing": "https://images.unsplash.com/photo-1533750516457-a7f992034fec?auto=format&fit=crop&w=800&q=80",
        "Meeting": "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&w=800&q=80",
        "Presentation": "https://images.unsplash.com/photo-1544531696-297afda286c3?auto=format&fit=crop&w=800&q=80",
        "Strategy": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?auto=format&fit=crop&w=800&q=80",
        "Analysis": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&w=800&q=80",
        "Admin": "https://images.unsplash.com/photo-1513128034602-7814ccbfd4ca?auto=format&fit=crop&w=800&q=80",
        "Client A": "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?auto=format&fit=crop&w=800&q=80",
        "Client B": "https://images.unsplash.com/photo-1552581234-26160f608093?auto=format&fit=crop&w=800&q=80",
        
        // Tech & Coding
        "Coding": "https://images.unsplash.com/photo-1587620962725-abab7fe55159?auto=format&fit=crop&w=800&q=80",
        "Backend": "https://images.unsplash.com/photo-1629654297299-c8506221ca97?auto=format&fit=crop&w=800&q=80",
        "Frontend": "https://images.unsplash.com/photo-1593720213428-28a5b9e94613?auto=format&fit=crop&w=800&q=80",
        "Database": "https://images.unsplash.com/photo-1544383835-bda2bc66a55d?auto=format&fit=crop&w=800&q=80",
        "Server": "https://images.unsplash.com/photo-1558494949-ef526b0042a0?auto=format&fit=crop&w=800&q=80",
        "Security": "https://images.unsplash.com/photo-1555949963-ff9fe0c870eb?auto=format&fit=crop&w=800&q=80",
        "Bug Fix": "https://images.unsplash.com/photo-1516116216624-53e697fedbea?auto=format&fit=crop&w=800&q=80",
        "Feature": "https://images.unsplash.com/photo-1555066931-4365d14bab8c?auto=format&fit=crop&w=800&q=80",
        "Launch": "https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80",
        "Review": "https://images.unsplash.com/photo-1512314889357-e157c22f938d?auto=format&fit=crop&w=800&q=80",

        // Design & Creative
        "Design": "https://images.unsplash.com/photo-1561070791-2526d30994b5?auto=format&fit=crop&w=800&q=80",
        "Ui/Ux": "https://images.unsplash.com/photo-1581291518633-83b4ebd1d83e?auto=format&fit=crop&w=800&q=80",
        "Photography": "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?auto=format&fit=crop&w=800&q=80",
        "Video": "https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?auto=format&fit=crop&w=800&q=80",
        "Content": "https://images.unsplash.com/photo-1455390582262-044cdead277a?auto=format&fit=crop&w=800&q=80",
        "Writing": "https://images.unsplash.com/photo-1455390582262-044cdead277a?auto=format&fit=crop&w=800&q=80",
        "Journaling": "https://images.unsplash.com/photo-1517842645767-c639042777db?auto=format&fit=crop&w=800&q=80",
        "Project": "https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?auto=format&fit=crop&w=800&q=80",
        "Idea": "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&w=800&q=80",
        "Social Media": "https://images.unsplash.com/photo-1611162617474-5b21e879e113?auto=format&fit=crop&w=800&q=80",

        // Life & Lifestyle
        "Personal": "https://images.unsplash.com/photo-1499750310159-5b5f096920b1?auto=format&fit=crop&w=800&q=80",
        "Health": "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?auto=format&fit=crop&w=800&q=80",
        "Education": "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?auto=format&fit=crop&w=800&q=80",
        "Fitness": "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?auto=format&fit=crop&w=800&q=80",
        "Diet": "https://images.unsplash.com/photo-1490645935967-10de6ba17061?auto=format&fit=crop&w=800&q=80",
        "Shopping": "https://images.unsplash.com/photo-1483985988355-763728e1935b?auto=format&fit=crop&w=800&q=80",
        "Travel": "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=800&q=80",
        "Family": "https://images.unsplash.com/photo-1511895426328-dc8714191300?auto=format&fit=crop&w=800&q=80",
        "Friends": "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?auto=format&fit=crop&w=800&q=80",
        "Relationship": "https://images.unsplash.com/photo-1621252179027-94459d27d3ee?auto=format&fit=crop&w=800&q=80",
        
        // Hobbies & Misc
        "Home": "https://images.unsplash.com/photo-1484154218962-a1c002085d2f?auto=format&fit=crop&w=800&q=80",
        "Garden": "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?auto=format&fit=crop&w=800&q=80",
        "Car": "https://images.unsplash.com/photo-1492144534655-ae79c964c9d7?auto=format&fit=crop&w=800&q=80",
        "Pet": "https://images.unsplash.com/photo-1450778869180-41d0601e046e?auto=format&fit=crop&w=800&q=80",
        "Music": "https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=800&q=80",
        "Movie": "https://images.unsplash.com/photo-1489599849927-2ee91cede3ba?auto=format&fit=crop&w=800&q=80",
        "Book": "https://images.unsplash.com/photo-1495446815901-a7297e633e8d?auto=format&fit=crop&w=800&q=80",
        "Event": "https://images.unsplash.com/photo-1501281668745-f7f57925c3b4?auto=format&fit=crop&w=800&q=80",
        "Side Hustle": "https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&w=800&q=80",
        "Research": "https://images.unsplash.com/photo-1434030216411-0b793f4b4173?auto=format&fit=crop&w=800&q=80"
    };

    // Helper: Ambil link gambar berdasarkan kategori
    function getCategoryImage(category) {
        // Jika ada di daftar, pakai. Jika tidak, pakai gambar default abstract.
        return categoryAssets[category] || "https://images.unsplash.com/photo-1550684848-fac1c5b4e853?auto=format&fit=crop&w=800&q=80";
    }
    const categoriesList = [
        "Work", "Personal", "Health", "Finance", "Education", "Coding", "Design", "Marketing", 
        "Meeting", "Research", "Writing", "Journaling", "Fitness", "Diet", "Shopping", 
        "Travel", "Family", "Friends", "Relationship", "Home", "Garden", "Car", 
        "Pet", "Music", "Movie", "Book", "Event", "Idea", "Project", "Side Hustle", 
        "Client A", "Client B", "Social Media", "Content", "Video", "Photography", 
        "Ui/Ux", "Backend", "Frontend", "Database", "Server", "Security", "Bug Fix", 
        "Feature", "Launch", "Review", "Strategy", "Analysis", "Presentation", "Admin"
    ];

    // Populate Select Option Kategori
    const catSelect = document.getElementById('inpCategory');
    categoriesList.forEach(cat => {
        const opt = document.createElement('option');
        opt.value = cat;
        opt.innerText = cat;
        catSelect.appendChild(opt);
    });
    // --- FITUR NAVIGASI SIDEBAR ---
   function navigate(pageId, element) {
        // ... kode class active menu ...
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => item.classList.remove('active'));
        if(element) element.classList.add('active');

        // ... kode hidden section ...
        const sections = document.querySelectorAll('.content-section');
        sections.forEach(sec => sec.classList.add('hidden'));

        const activeSection = document.getElementById('page-' + pageId);
        if(activeSection) {
            activeSection.classList.remove('hidden');
            
            // RENDER ULANG SESUAI HALAMAN
            if(pageId === 'ideas') renderIdeas();
            if(pageId === 'plans') renderPlans();
            if(pageId === 'journal') renderJournals();
            if(pageId === 'dashboard') renderDashboard(); // <--- TAMBAHAN INI
            if(pageId === 'notulensi') renderNotulensi(); // <--- TAMBAHAN INI
        }
    }
    // --- FITUR SAPAAN DINAMIS (DYNAMIC GREETING) ---
    function updateGreeting() {
        const hour = new Date().getHours(); // Ambil jam saat ini (0-23)
        const titleEl = document.getElementById('greetTitle');
        const descEl = document.getElementById('greetDesc');

        let titleText = "";
        let descText = "";

        // Logika Waktu (Bisa disesuaikan jamnya)
        if (hour >= 5 && hour < 11) {
            // Pagi (05:00 - 10:59)
            titleText = "Good Morning.";
            descText = "Awali hari ini dengan ide cemerlang dan semangat baru.";
        } 
        else if (hour >= 11 && hour < 15) {
            // Siang (11:00 - 14:59)
            titleText = "Good Afternoon.";
            descText = "Jaga momentum produktivitasmu. Fokus dan selesaikan target.";
        } 
        else if (hour >= 15 && hour < 19) {
            // Sore (15:00 - 18:59)
            titleText = "Good Evening.";
            descText = "Waktunya mengevaluasi progres hari ini dan sedikit bersantai.";
        } 
        else {
            // Malam (19:00 - 04:59)
            titleText = "Good Night.";
            descText = "Istirahatkan pikiranmu. Simpan ide-ide hebat ini untuk esok hari.";
        }

        // Terapkan ke HTML
        titleEl.innerText = titleText;
        descEl.innerText = descText;
    }

    // Panggil fungsi ini agar langsung jalan saat web dibuka
    updateGreeting();
// --- FUNGSI GENERATE STAGE DINAMIS ---
function generateStages() {
    const count = document.getElementById('inpStageCount').value;
    const container = document.getElementById('stageContainer');
    container.innerHTML = ''; // Reset dulu

    if(count < 1) return;

    for(let i = 1; i <= count; i++) {
        const div = document.createElement('div');
        div.style.cssText = "background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); position:relative;";
        div.innerHTML = `
            <span style="position:absolute; top:5px; right:10px; color:var(--danger); cursor:pointer; font-size:1.2rem;" onclick="this.parentElement.remove()">&times;</span>
            <strong style="display:block; margin-bottom:5px; font-size:0.8rem; color:#2dd4bf;">Stage ${i}</strong>
            <input type="text" class="stage-title" placeholder="Judul Stage ${i}" style="margin-bottom:5px;">
            <input type="text" class="stage-desc" placeholder="Deskripsi/Target Stage ${i}">
        `;
        container.appendChild(div);
    }
}
    // --- 2. INISIALISASI DATA ---
    let ideas = JSON.parse(localStorage.getItem('myIdeas')) || [];
function applyFilters() {
        renderIdeas(); // Panggil render ulang, nanti renderIdeas yang akan baca value inputnya
    }
    // --- 3. FUNGSI RENDER (DENGAN STATUS & GAMBAR OTOMATIS) ---
    // --- 3. FUNGSI RENDER (REVISI LAYOUT CARD) ---
   // --- 3. FUNGSI RENDER (REVISI: HAPUS KATEGORI TUGAS DI CARD) ---
    function renderIdeas() {
        const container = document.getElementById('ideasContainer');
        container.innerHTML = ''; 
// 1. Ambil Value Search & Filter
        const searchTerm = document.getElementById('inpSearch').value.toLowerCase();
        const filterVal = document.getElementById('inpFilter').value;

        // 2. Buat Copy Array agar data asli tidak rusak saat disortir
        let filteredIdeas = [...ideas];

        // --- LOGIKA PENCARIAN (SEARCH) ---
        if(searchTerm.trim() !== "") {
            filteredIdeas = filteredIdeas.filter(idea => 
                idea.title.toLowerCase().includes(searchTerm)
            );
        }

        // --- LOGIKA FILTER & SORTING ---
        if(filterVal === 'newest') {
            // Urutkan berdasarkan tanggal DESC (Terbaru ke Terlama)
            filteredIdeas.sort((a, b) => new Date(b.createdAt || b.id) - new Date(a.createdAt || a.id));
        } 
        else if(filterVal === 'oldest') {
            // Urutkan berdasarkan tanggal ASC (Terlama ke Terbaru)
            filteredIdeas.sort((a, b) => new Date(a.createdAt || a.id) - new Date(b.createdAt || b.id));
        }
        else if(filterVal === 'status_todo') {
            filteredIdeas = filteredIdeas.filter(i => i.status === 'Belum Dimulai');
        }
        else if(filterVal === 'status_doing') {
            filteredIdeas = filteredIdeas.filter(i => i.status === 'Dikerjakan');
        }
        else if(filterVal === 'status_done') {
            filteredIdeas = filteredIdeas.filter(i => i.status === 'Sudah Selesai');
        }

        // --- JIKA HASIL PENCARIAN KOSONG ---
        if(filteredIdeas.length === 0) {
            container.innerHTML = `
                <div style="grid-column: 1/-1; text-align:center; padding: 3rem; color:var(--text-muted);">
                    <i class="ph ph-magnifying-glass" style="font-size: 3rem; margin-bottom:1rem; opacity:0.5;"></i>
                    <p>Tidak ditemukan tugas dengan kata kunci "<b>${document.getElementById('inpSearch').value}</b>" atau filter yang dipilih.</p>
                </div>
            `;
            return;
        }
       filteredIdeas.forEach(idea => {     const card = document.createElement('div');
            card.className = 'card';
            
            // --- LOGIKA GAMBAR BARU ---
            // 1. Cek apakah user input link manual?
            // 2. Jika tidak, ambil dari categoryAssets berdasarkan kategori yang dipilih
            const displayImg = idea.img && idea.img.trim() !== '' 
                ? idea.img 
                : getCategoryImage(idea.category);
            // Fallback Status (Kategori Tugas tidak diambil untuk tampilan card)
            const statusDisplay = idea.status || 'Belum Dimulai';

            // Warna Badge Status
            let statusColor = '#94a3b8'; // default gray
            if(statusDisplay === 'Sudah Selesai') statusColor = '#10b981'; // green
            if(statusDisplay === 'Dikerjakan') statusColor = '#3b82f6'; // blue
            if(statusDisplay === 'Pending') statusColor = '#f59e0b'; // orange

            card.innerHTML = `
                <div class="card-actions-float">
                    <button class="btn-icon btn-dup" onclick="duplicateIdea(${idea.id}, event)" title="Duplicate"><i class="ph ph-copy"></i></button>
                    <button class="btn-icon btn-del" onclick="deleteIdea(${idea.id}, event)" title="Delete"><i class="ph ph-trash"></i></button>
                </div>
                
                <img src="${displayImg}" class="card-img" alt="Cover" loading="lazy">
                
                <div class="card-body" onclick="openDetailView(${idea.id})">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem;">
                        <span class="card-tag" style="margin-bottom:0;">${idea.category}</span>
                        
                        <span style="font-size:0.65rem; font-weight:600; color:${statusColor}; border:1px solid ${statusColor}; padding:2px 8px; border-radius:10px;">
                            ${statusDisplay}
                        </span>
                    </div>

                    <h3 class="card-title">${idea.title}</h3>
                    <p class="card-desc">${idea.desc}</p>
                    
                    <div class="card-footer">
                        <span><i class="ph ph-calendar"></i> ${formatDate(idea.startDate)}</span>
                        <span style="font-size:0.8rem; color:${idea.importance === 'Urgent' ? '#ef4444' : 'inherit'}">
                            ${idea.importance || ''}
                        </span>
                    </div>
                </div>
            `;
            container.appendChild(card);
       
       
        });
    }
    // --- 4. CRUD LOGIC (KOMPREHENSIF) ---
// --- FUNGSI GENERATE CUSTOM FIELDS DINAMIS ---
    function generateCustomFields() {
        const count = document.getElementById('inpCustomCount').value;
        const container = document.getElementById('customFieldsContainer');
        container.innerHTML = ''; // Reset

        if(count < 1) return;

        for(let i = 1; i <= count; i++) {
            const div = document.createElement('div');
            
            // [PENTING] Kita tambahkan class 'custom-field-item' agar mudah diambil saat Save
            div.className = 'custom-field-item'; 
            
            div.style.cssText = "background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); position:relative;";
            
            div.innerHTML = `
                <span style="position:absolute; top:5px; right:10px; color:var(--danger); cursor:pointer; font-size:1.2rem;" onclick="this.parentElement.remove()" title="Hapus">&times;</span>
                <div style="display:grid; grid-template-columns: 1fr 2fr; gap:10px;">
                    <div>
                        <small style="color:#2dd4bf; display:block; margin-bottom:4px;">Label</small>
                        <input type="text" class="custom-label" placeholder="Cth: Klien" style="width:100%; background:rgba(0,0,0,0.3); border:1px solid #444; color:white; padding:5px; border-radius:4px;">
                    </div>
                    <div>
                        <small style="color:#2dd4bf; display:block; margin-bottom:4px;">Isi Informasi</small>
                        <input type="text" class="custom-value" placeholder="Isi data..." style="width:100%; background:rgba(0,0,0,0.3); border:1px solid #444; color:white; padding:5px; border-radius:4px;">
                    </div>
                </div>
            `;
            container.appendChild(div);
        }
    }
    function saveIdea() {
    const id = document.getElementById('ideaId').value;
    
    // 1. Ambil Data Stages Manual
    const stageContainer = document.getElementById('stageContainer');
    const stageDivs = stageContainer.querySelectorAll('div');
    let stagesData = [];
    stageDivs.forEach(div => {
        stagesData.push({
            title: div.querySelector('.stage-title').value,
            desc: div.querySelector('.stage-desc').value
        });
    });
// 2. Ambil Data Custom Fields (INFO TAMBAHAN BARU)
    // [REVISI] CARA AMBIL DATA CUSTOM FIELDS LEBIH KUAT
    const customContainer = document.getElementById('customFieldsContainer');
    
    // Kita cari berdasarkan class yang baru kita buat
    const customDivs = customContainer.getElementsByClassName('custom-field-item'); 
    
    let customDataList = [];
    
    // Loop melalui elemen HTML Collection
    Array.from(customDivs).forEach(div => {
        const labelInp = div.querySelector('.custom-label');
        const valInp = div.querySelector('.custom-value');
        
        // Simpan jika input ada isinya
        if(labelInp && valInp && labelInp.value.trim() !== "") {
            customDataList.push({ 
                label: labelInp.value, 
                value: valInp.value 
            });
        }
    });
    // 2. Data Object Lengkap
    const now = new Date().toISOString(); // Timestamp saat ini
    const existingData = ideas.find(x => x.id == id); // Cek data lama untuk Create Date

    const dataObj = {
        id: id ? parseInt(id) : Date.now(),
        // Data Lama
        title: document.getElementById('inpTitle').value,
        category: document.getElementById('inpCategory').value,
        teamCat: document.getElementById('inpTeamCat').value || 'Individu', // Default Individu
        status: document.getElementById('inpStatus').value,
        importance: document.getElementById('inpImportance').value,
        timezone: document.getElementById('inpTimezone').value,
        // -- WAKTU DETIL --
        startDate: document.getElementById('inpStartDate').value,
        startTime: document.getElementById('inpStartTime').value,
        endDate: document.getElementById('inpEndDate').value,
        endTime: document.getElementById('inpEndTime').value,
        // -- DATA BARU --
        owner: document.getElementById('inpOwner').value,
        timeSpent: document.getElementById('inpTimeSpent').value,
        progress: document.getElementById('inpProgressRange').value,
        stages: stagesData, // Array stage
        createdAt: existingData ? existingData.createdAt : now, // Jika edit, tgl buat tetap. Jika baru, pakai now.
        updatedAt: now, // Selalu update waktu simpan
        // -- LAINNYA --
        taskType: document.getElementById('inpTaskType').value,
        medium: document.getElementById('inpMedium').value,
        docLink: document.getElementById('inpDocLink').value,
        desc: document.getElementById('inpDesc').value,
        notes: document.getElementById('inpNotes').value,
        img: document.getElementById('inpImg').value,
        // Custom fields...
        customFields: customDataList,
    };

    if(!dataObj.title || !dataObj.startDate) {
        alert("Mohon isi Judul dan Tanggal Mulai minimal.");
        return;
    }

    if (id) {
        const index = ideas.findIndex(x => x.id == id);
        ideas[index] = dataObj;
    } else {
        ideas.push(dataObj);
    }

    updateStorage();
    closeModal();
    renderIdeas();
}
    function deleteIdea(id, event) {
        event.stopPropagation();
        if(confirm('Hapus kartu ini selamanya?')) {
            ideas = ideas.filter(item => item.id !== id);
            updateStorage();
            renderIdeas();
        }
    }

    function duplicateIdea(id, event) {
        event.stopPropagation();
        const original = ideas.find(item => item.id === id);
        if(original) {
            const copy = { ...original, id: Date.now(), title: original.title + " (Copy)", status: 'Belum Dimulai' };
            ideas.push(copy);
            updateStorage();
            renderIdeas();
        }
    }

    // --- 5. DETAIL VIEW POPULATE ---
    let currentDetailId = null;

    function openDetailView(id) {
        const item = ideas.find(x => x.id === id);
        if(!item) return;
        currentDetailId = id;

        // Populate Text
        document.getElementById('viewTitle').innerText = item.title;
        document.getElementById('viewCategoryBadge').innerText = item.category;
        document.getElementById('viewStatusBadge').innerText = item.status;
        document.getElementById('viewTeamBadge').innerText = item.teamCat;
        document.getElementById('viewImportance').innerText = item.importance;
       // Menampilkan Timezone (Fallback ke WIB jika data lama kosong)
const tz = item.timezone ? item.timezone : 'WIB';
document.getElementById('viewTimezone').innerText = tz; 
        document.getElementById('viewStartDate').innerText = formatDate(item.startDate);
        document.getElementById('viewEndDate').innerText = formatDate(item.endDate);
        document.getElementById('viewTaskType').innerText = item.taskType || '-';
        document.getElementById('viewMedium').innerText = item.medium || '-';
        
        document.getElementById('viewDesc').innerText = item.desc;
        document.getElementById('viewNotes').innerText = item.notes ? item.notes : "Tidak ada catatan tambahan.";
        // 1. Owner & Dates
    document.getElementById('viewOwner').innerText = item.owner || '-';
    document.getElementById('viewCreated').innerText = formatDate(item.createdAt);
    document.getElementById('viewUpdated').innerText = formatDate(item.updatedAt);
    
    // 2. Durasi & Progress
    const duration = calculateDuration(item.startDate, item.startTime, item.endDate, item.endTime);
    document.getElementById('viewDuration').innerText = duration;
    document.getElementById('viewTimeSpent').innerText = item.timeSpent || '-';
    // --- UPDATE GAMBAR DI DETAIL VIEW ---
    // Link
       
        // --- UPDATE GAMBAR DI DETAIL VIEW ---
        // --- UPDATE GAMBAR DI DETAIL VIEW (REVISI) ---
        // Cek apakah ada gambar manual yg valid? Jika tidak, ambil dari kategori.
        let imageSource;
        // Cek apakah ada gambar manual yg valid?
        if (item.img && item.img.trim().length > 10) { 
            imageSource = item.img; 
        } else {
            // Jika tidak, ambil dari dictionary categoryAssets (fungsi helper)
            imageSource = getCategoryImage(item.category); 
        }
        document.getElementById('viewImg').src = imageSource;
    // Update Progress Bar
    const prog = item.progress || 0;
    document.getElementById('viewProgressBar').style.width = prog + '%';
    document.getElementById('viewProgressText').innerText = prog + '% Completed';

    // 3. Render Stages List
  // 3. Render Stages List
 // 3. Render Stages List (REVISI JARAK GAP)
        const stageList = document.getElementById('viewStagesList');
        stageList.innerHTML = '';
        
        if(item.stages && item.stages.length > 0) {
            item.stages.forEach((stg, idx) => {
                const row = document.createElement('div');
                
                // Style Container (Tetap Glassmorphism)
                row.style.cssText = `
                    background: linear-gradient(135deg, rgba(45, 212, 191, 0.08) 0%, rgba(255, 255, 255, 0.02) 100%);
                    backdrop-filter: blur(5px);
                    border: 1px solid rgba(255, 255, 255, 0.08);
                    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
                    padding: 1.2rem;
                    border-radius: 14px;
                    margin-bottom: 1rem;
                    transition: transform 0.2s, border-color 0.2s;
                    position: relative;
                    overflow: hidden;
                `;

                row.innerHTML = `
                    <div style="
                        /* [REVISI] Jarak bawah dikurangi drastis (dari 0.8rem jadi 0.4rem) */
                        margin-bottom: -1rem; 
                        
                        border-bottom: 1px solid rgba(255,255,255,0.05);
                        
                        /* [REVISI] Padding bawah juga dikurangi */
                        padding-bottom: 0.4rem; 
                    ">
                        <strong style="color: #2dd4bf; font-size: 1rem; letter-spacing: 0.5px; display:block;">
                            Stage ${idx+1}: <span style="color:white;">${stg.title}</span>
                        </strong>
                    </div>
                    
                    <div style="
                        color: #cbd5e1; 
                        font-size: 0.9rem; 
                        line-height: 1.5; /* Line height sedikit dipadatkan */
                        
                        text-align: justify;
                        text-justify: inter-word;
                        
                        word-break: break-word;
                        overflow-wrap: break-word;
                        white-space: pre-line; 
                        width: 100%;
                        margin-top: 0; /* Pastikan tidak ada jarak atas */
                    ">
                        ${stg.desc}
                    </div>
                `;
                
                // Hover Effect
                row.onmouseenter = function() { this.style.transform = 'translateY(-2px)'; this.style.borderColor = 'rgba(45, 212, 191, 0.3)'; };
                row.onmouseleave = function() { this.style.transform = 'translateY(0)'; this.style.borderColor = 'rgba(255, 255, 255, 0.08)'; };

                stageList.appendChild(row);
            });
        } else {
            stageList.innerHTML = '<div style="background:rgba(255,255,255,0.03); padding:1rem; border-radius:10px; text-align:center; color:var(--text-muted); font-size:0.9rem;">Belum ada tahapan kerja.</div>';
        }
        // Custom Fields Render
        // --- RENDER CUSTOM FIELDS (REVISI: SUPPORT DATA BARU & LAMA) ---
        // [DALAM openDetailView] RENDER CUSTOM FIELDS
        // --- RENDER CUSTOM FIELDS (REVISI DESAIN PREMIUM) ---
        const customContainer = document.getElementById('viewCustomFields');
        customContainer.innerHTML = ''; 
        
        // Ubah Grid Layout agar kartu punya ruang nafas
        customContainer.style.cssText = "display:grid; grid-template-columns: 1fr 1fr; gap:1.2rem; font-size:0.9rem;";

        let hasData = false;

        // Helper render function untuk kartu yang elegan
        // Helper render function untuk kartu yang elegan (REVISI JARAK)
        const renderFieldCard = (label, value) => {
            const div = document.createElement('div');
            
            div.style.cssText = `
                background: linear-gradient(145deg, rgba(255, 255, 255, 0.07) 0%, rgba(255, 255, 255, 0.01) 100%);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.08);
                border-radius: 16px;
                padding: 1.2rem;
                box-shadow: 0 4px 20px -5px rgba(0,0,0,0.2);
                display: flex;
                flex-direction: column;
                justify-content: flex-start; /* Pastikan isi mulai dari atas */
                transition: transform 0.2s ease;
                min-height: 100px;
            `;

            div.onmouseenter = function() { this.style.transform = 'translateY(-3px)'; this.style.borderColor = 'rgba(45, 212, 191, 0.3)'; };
            div.onmouseleave = function() { this.style.transform = 'translateY(0)'; this.style.borderColor = 'rgba(255, 255, 255, 0.08)'; };

            div.innerHTML = `
                <div style="
                    color: #2dd4bf; 
                    font-size: 1rem; 
                    text-transform: uppercase; 
                    letter-spacing: 1.5px; 
                    font-weight: 700;
                    
                    /* [REVISI DISINI] Jarak bawah dikurangi agar deskripsi naik */
                    margin-bottom: -1rem; 
                    
                    border-bottom: 1px solid rgba(255,255,255,0.05);
                    padding-bottom: 0.4rem; 
                ">
                    ${label}
                </div>

                <div style="
                    color: #e2e8f0; 
                    font-size: 0.85rem; 
                    line-height: 1.5; /* Line height sedikit dipadatkan */
                    font-weight: 400;
                    text-align: justify;
                    text-justify: inter-word;
                    word-break: break-word;
                    overflow-wrap: break-word;
                    white-space: pre-line; 
                    margin-top: 0; /* Pastikan tidak ada margin atas tambahan */
                ">
                    ${value}
                </div>
            `;
            customContainer.appendChild(div);
        };
        // 1. Render Data Baru (Array Dinamis)
        if (item.customFields && item.customFields.length > 0) {
            hasData = true;
            item.customFields.forEach(field => renderFieldCard(field.label, field.value));
        } 
        // 2. Fallback: Render Data Lama (Field 1-5 statis)
        else if (item.custom1 || item.custom2 || item.custom3 || item.custom4 || item.custom5) {
             hasData = true;
             [1,2,3,4,5].forEach(num => {
                 const val = item['custom' + num];
                 if(val) renderFieldCard(`Info ${num}`, val);
             });
        }

        if(!hasData) {
            customContainer.innerHTML = '<div style="grid-column:span 2; color:var(--text-muted); font-style:italic; opacity:0.6; text-align:center; padding:1rem;">Tidak ada informasi tambahan.</div>';
        }

        // Tampilkan pesan jika kosong
        if(!hasData) {
            customContainer.innerHTML = '<div style="grid-column:span 2; color:var(--text-muted); font-style:italic; opacity:0.7;">Tidak ada informasi tambahan.</div>';
        }

        // Link
        const linkBtn = document.getElementById('viewDocLink');
        if(item.docLink) {
            linkBtn.href = item.docLink;
            linkBtn.style.display = 'flex';
        } else {
            linkBtn.style.display = 'none';
        }

       

        // UI Switch
        document.getElementById('modalTitle').innerText = "Detail Tugas";
        document.getElementById('ideaForm').classList.add('hidden');
        document.getElementById('detailView').classList.remove('hidden');
        document.getElementById('formActions').classList.add('hidden');
        document.getElementById('detailActions').classList.remove('hidden');
        document.getElementById('modalOverlay').classList.add('active');
    }



    
    // --- 6. EDIT MODE RE-POPULATE ---
    function switchToEditMode() {
        const item = ideas.find(x => x.id === currentDetailId);
        if(!item) return;

        // Isi balik semua field form
        document.getElementById('ideaId').value = item.id;
        document.getElementById('inpTitle').value = item.title;
        document.getElementById('inpCategory').value = item.category;
        document.getElementById('inpTeamCat').value = item.teamCat;
        document.getElementById('inpStatus').value = item.status;
        document.getElementById('inpImportance').value = item.importance;
        document.getElementById('inpStartDate').value = item.startDate;
        document.getElementById('inpEndDate').value = item.endDate;
        document.getElementById('inpTimezone').value = item.timezone;
        document.getElementById('inpTaskType').value = item.taskType;
        document.getElementById('inpMedium').value = item.medium;
        document.getElementById('inpDocLink').value = item.docLink;
        document.getElementById('inpDesc').value = item.desc;
        document.getElementById('inpNotes').value = item.notes;
        document.getElementById('inpImg').value = item.img;
        
        document.getElementById('inpTimezone').value = item.timezone || 'WIB';
        document.getElementById('inpImg').value = item.img; // Link manual tetap dimuat di form

        document.getElementById('modalTitle').innerText = "Edit Data";
        document.getElementById('detailView').classList.add('hidden');
        document.getElementById('ideaForm').classList.remove('hidden');
        document.getElementById('detailActions').classList.add('hidden');
        document.getElementById('formActions').classList.remove('hidden');
       
    // --- SISIPKAN BAGIAN INI ---
    document.getElementById('inpStartTime').value = item.startTime || '';
    document.getElementById('inpEndTime').value = item.endTime || '';
    document.getElementById('inpOwner').value = item.owner || '';
    document.getElementById('inpTimeSpent').value = item.timeSpent || '';
    
    // Load Progress
    document.getElementById('inpProgressRange').value = item.progress || 0;
    document.getElementById('progressVal').innerText = (item.progress || 0) + '%';
// [DALAM openDetailView] REVISI TAMPILAN CUSTOM FIELDS
        const customContainer = document.getElementById('viewCustomFields');
        customContainer.innerHTML = ''; // Bersihkan dulu
        
        // Ubah grid agar rapi (2 kolom)
        customContainer.style.cssText = "display:grid; grid-template-columns: 1fr 1fr; gap:1.5rem; font-size:0.9rem;";

        if (item.customFields && item.customFields.length > 0) {
            item.customFields.forEach(field => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <small style="color:var(--text-muted); display:block; text-transform:uppercase; font-size:0.75rem; letter-spacing:0.5px;">${field.label}</small>
                    <div style="font-weight:500; color:white;">${field.value}</div>
                `;
                customContainer.appendChild(div);
            });
        } else {
            // Tampilkan pesan jika kosong (opsional) atau biarkan kosong
            customContainer.innerHTML = '<span style="color:var(--text-muted); grid-column: span 2;">Tidak ada informasi tambahan.</span>';
        }
    // Load Stages ke Form (Agak tricky, kita harus create elemennya dulu)
    const container = document.getElementById('stageContainer');
    container.innerHTML = ''; // bersihkan
    if(item.stages && item.stages.length > 0) {
        document.getElementById('inpStageCount').value = item.stages.length;
        // Loop create input
        item.stages.forEach((stg, i) => {
             const div = document.createElement('div');
            div.style.cssText = "background:rgba(255,255,255,0.05); padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.1); position:relative;";
            div.innerHTML = `
                <span style="position:absolute; top:5px; right:10px; color:var(--danger); cursor:pointer;" onclick="this.parentElement.remove()">&times;</span>
                <strong style="display:block; margin-bottom:5px; font-size:0.8rem; color:#2dd4bf;">Stage ${i+1}</strong>
                <input type="text" class="stage-title" value="${stg.title}" placeholder="Judul Stage" style="margin-bottom:5px;">
                <input type="text" class="stage-desc" value="${stg.desc}" placeholder="Deskripsi">
            `;
            container.appendChild(div);
        });
    }

    }
// Menghitung selisih waktu Start vs End
function calculateDuration(d1, t1, d2, t2) {
    if(!d1 || !d2) return "-";
    // Gabungkan tanggal dan jam (default jam 00:00:00 jika kosong)
    const start = new Date(`${d1}T${t1 || '00:00:00'}`);
    const end = new Date(`${d2}T${t2 || '23:59:59'}`);
    
    const diffMs = end - start; // Selisih milidetik
    if (diffMs < 0) return "Tanggal End invalid";

    // Konversi
    const days = Math.floor(diffMs / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diffMs % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    
    return `${days} Hari, ${hours} Jam`;
}
    // --- 7. UTILS ---
    function openFormModal() {
        document.getElementById('ideaForm').reset();
        document.getElementById('ideaId').value = '';
        // Set default date hari ini agar user tidak repot
        document.getElementById('inpStartDate').valueAsDate = new Date();
        document.getElementById('inpEndDate').valueAsDate = new Date();

        document.getElementById('modalTitle').innerText = "Tambah Tugas Baru";
        document.getElementById('ideaForm').classList.remove('hidden');
        document.getElementById('detailView').classList.add('hidden');
        document.getElementById('formActions').classList.remove('hidden');
        document.getElementById('detailActions').classList.add('hidden');
        document.getElementById('modalOverlay').classList.add('active');
    }

    function closeModal() {
        document.getElementById('modalOverlay').classList.remove('active');
    }

    function updateStorage() {
        localStorage.setItem('myIdeas', JSON.stringify(ideas));
    }

    function formatDate(dateString) {
        if(!dateString) return '-';
        const options = { year: 'numeric', month: 'short', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('id-ID', options);
    }

    // INIT
    renderIdeas();
    document.getElementById('modalOverlay').addEventListener('click', (e) => {
        if(e.target === document.getElementById('modalOverlay')) closeModal();
    });




    // --- LOGIKA FITUR PLANS (TERPISAH DARI IDEAS) ---
// --- 1. SETUP GAMBAR KATEGORI PLANS (STATIC LINKS - 50 ITEMS) ---
    // Menggunakan metode Direct URL agar loading cepat dan tidak error
    const planCategoryAssets = {
        // Business & Strategy
        "Business Strategy": "https://images.unsplash.com/photo-1552664730-d307ca884978?auto=format&fit=crop&w=800&q=80",
        "Marketing Campaign": "https://images.unsplash.com/photo-1533750516457-a7f992034fec?auto=format&fit=crop&w=800&q=80",
        "Financial Audit": "https://images.unsplash.com/photo-1554224155-984063584d45?auto=format&fit=crop&w=800&q=80",
        "Product Launch": "https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80",
        "HR Hiring": "https://images.unsplash.com/photo-1521791136064-7986c2920216?auto=format&fit=crop&w=800&q=80",
        "Team Building": "https://images.unsplash.com/photo-1522071820081-009f0129c71c?auto=format&fit=crop&w=800&q=80",
        "Legal Compliance": "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?auto=format&fit=crop&w=800&q=80",
        "Contract Review": "https://images.unsplash.com/photo-1450101499163-c8848c66ca85?auto=format&fit=crop&w=800&q=80",
        "Partnership": "https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&w=800&q=80",
        "Investor Pitch": "https://images.unsplash.com/photo-1542744173-8e7e53415bb0?auto=format&fit=crop&w=800&q=80",
        "Funding Round": "https://images.unsplash.com/photo-1579621970563-ebec7560eb3e?auto=format&fit=crop&w=800&q=80",
        "Sales Target": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?auto=format&fit=crop&w=800&q=80",
        "Lead Generation": "https://images.unsplash.com/photo-1460925895917-afdab827c52f?auto=format&fit=crop&w=800&q=80",
        "Customer Support": "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?auto=format&fit=crop&w=800&q=80",
        "User Research": "https://images.unsplash.com/photo-1551434678-e076c223a692?auto=format&fit=crop&w=800&q=80",
        "Market Analysis": "https://images.unsplash.com/photo-1590283603385-17ffb3a7f29f?auto=format&fit=crop&w=800&q=80",

        // Tech & Development
        "Software Dev": "https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=800&q=80",
        "App Update": "https://images.unsplash.com/photo-1512941937669-90a1b58e7e9c?auto=format&fit=crop&w=800&q=80",
        "Server Maintenance": "https://images.unsplash.com/photo-1558494949-ef526b0042a0?auto=format&fit=crop&w=800&q=80",
        "Database Migration": "https://images.unsplash.com/photo-1544383835-bda2bc66a55d?auto=format&fit=crop&w=800&q=80",
        "SEO Overhaul": "https://images.unsplash.com/photo-1432888498266-38ffec3eaf0a?auto=format&fit=crop&w=800&q=80",
        "Video Production": "https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?auto=format&fit=crop&w=800&q=80",
        "Podcast Series": "https://images.unsplash.com/photo-1478737270239-2f02b77ac6d5?auto=format&fit=crop&w=800&q=80",
        "Social Media Blitz": "https://images.unsplash.com/photo-1611162617474-5b21e879e113?auto=format&fit=crop&w=800&q=80",
        "Content Calendar": "https://images.unsplash.com/photo-1506784983877-45594efa4cbe?auto=format&fit=crop&w=800&q=80",

        // Events & Operations
        "Event Organizing": "https://images.unsplash.com/photo-1511578314322-379afb476865?auto=format&fit=crop&w=800&q=80",
        "Conference": "https://images.unsplash.com/photo-1544531696-297afda286c3?auto=format&fit=crop&w=800&q=80",
        "Webinar": "https://images.unsplash.com/photo-1609921212029-bb5a28e60960?auto=format&fit=crop&w=800&q=80",
        "Workshop": "https://images.unsplash.com/photo-1531482615713-2afd69097998?auto=format&fit=crop&w=800&q=80",
        "Networking": "https://images.unsplash.com/photo-1515187029135-18ee286d815b?auto=format&fit=crop&w=800&q=80",
        "Office Move": "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=800&q=80",
        "Renovation": "https://images.unsplash.com/photo-1503387762-592deb58ef4e?auto=format&fit=crop&w=800&q=80",
        "Interior Design": "https://images.unsplash.com/photo-1618221195710-dd6b41faaea6?auto=format&fit=crop&w=800&q=80",
        "Inventory Check": "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?auto=format&fit=crop&w=800&q=80",
        "Supply Chain": "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?auto=format&fit=crop&w=800&q=80", // Pakai gambar warehouse
        
        // Personal & Lifestyle
        "Travel Plan": "https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?auto=format&fit=crop&w=800&q=80",
        "Corporate Retreat": "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?auto=format&fit=crop&w=800&q=80",
        "Training Session": "https://images.unsplash.com/photo-1524178232363-1fb2b075b655?auto=format&fit=crop&w=800&q=80",
        "Skill Upgrade": "https://images.unsplash.com/photo-1501504905252-473c47e087f8?auto=format&fit=crop&w=800&q=80",
        "Certification": "https://images.unsplash.com/photo-1546410531-bb4caa6b424d?auto=format&fit=crop&w=800&q=80",
        "Health Program": "https://images.unsplash.com/photo-1511632765486-a019809dd84e?auto=format&fit=crop&w=800&q=80",
        "Gym Routine": "https://images.unsplash.com/photo-1534438327276-14e5300c3a48?auto=format&fit=crop&w=800&q=80",
        "Diet Plan": "https://images.unsplash.com/photo-1490645935967-10de6ba17061?auto=format&fit=crop&w=800&q=80",
        "Mental Wellness": "https://images.unsplash.com/photo-1506126613408-eca07ce68773?auto=format&fit=crop&w=800&q=80",
        "Meditation": "https://images.unsplash.com/photo-1554244933-d877fea46dd3?auto=format&fit=crop&w=800&q=80",
        "Family Trip": "https://images.unsplash.com/photo-1542038784456-1ea8e935640e?auto=format&fit=crop&w=800&q=80",
        "Wedding Plan": "https://images.unsplash.com/photo-1511795409834-ef04bbd61622?auto=format&fit=crop&w=800&q=80",
        "Birthday Party": "https://images.unsplash.com/photo-1464349153912-65211797f3b7?auto=format&fit=crop&w=800&q=80",
        "Home Improvement": "https://images.unsplash.com/photo-1581578731117-104f2a863a30?auto=format&fit=crop&w=800&q=80",
        "Garden Project": "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?auto=format&fit=crop&w=800&q=80"
    };

    // --- 2. UPDATE DROPDOWN KATEGORI PLANS ---
    // (Otomatis mengambil keys dari object di atas)
    const planCatSelect = document.getElementById('inpPlanCategory');
    if(planCatSelect) {
        planCatSelect.innerHTML = ''; // Bersihkan opsi lama
        Object.keys(planCategoryAssets).sort().forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat;
            opt.innerText = cat;
            planCatSelect.appendChild(opt);
        });
    }

    // --- 3. UPDATE FUNGSI GET PLAN IMAGE (VERSI STATIC) ---
    // Persis seperti di fitur Ideas, tapi membaca variable 'planCategoryAssets'
    function getPlanImage(category) {
        // Cek apakah kategori ada di daftar? Jika tidak, pakai fallback
        return planCategoryAssets[category] || "https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?auto=format&fit=crop&w=800&q=80";
    }
   
    // 1. Init Data Plans
    let plans = JSON.parse(localStorage.getItem('myPlans')) || [];

    // 2. Render Plans Card
  function generateDynamicField(type) {
        const count = document.getElementById(`count${type}`).value;
        const wrapper = document.getElementById(`wrapper${type}`);
        wrapper.innerHTML = '';
        
        if(count < 1) return;

        for(let i=1; i<=count; i++) {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                             <strong style="display:block; color:#a78bfa; margin-bottom:5px;">${type} #${i}</strong>`;

            // Field Khusus per Tipe
            if(type === 'Goals') {
                div.innerHTML += `
                    <input type="text" class="field-name" placeholder="Nama Goal">
                    <div style="display:flex; gap:5px;"><input type="date" class="field-start"><input type="date" class="field-end"></div>
                    <textarea class="field-desc" placeholder="Deskripsi Goal"></textarea>
                `;
            } else if(type === 'SubTasks') {
                div.innerHTML += `
                    <input type="text" class="field-name" placeholder="Nama Sub-Tugas">
                    <input type="text" class="field-target" placeholder="Target Output">
                    <input type="text" class="field-progress" placeholder="Progress (%)">
                    <textarea class="field-desc" placeholder="Deskripsi Tugas"></textarea>
                `;
            } else {
                // Default (Risk, Impact, Mitigation, Milestones) -> Nama & Deskripsi
                div.innerHTML += `
                    <input type="text" class="field-name" placeholder="Nama ${type}">
                    <textarea class="field-desc" placeholder="Deskripsi ${type}"></textarea>
                `;
            }
            wrapper.appendChild(div);
        }
    }

    // --- RENDER CARD PLANS (Dashboard View) ---
    // --- RENDER CARD PLANS (REVISI FULL IMAGE & POSISI LABEL) ---
    function renderPlans() {
        const container = document.getElementById('plansContainer');
        container.innerHTML = '';
        // 1. Ambil Nilai Search & Filter
        const searchTerm = document.getElementById('inpSearchPlan') ? document.getElementById('inpSearchPlan').value.toLowerCase() : "";
        const filterVal = document.getElementById('inpPlanFilter') ? document.getElementById('inpPlanFilter').value : "newest";

        // 2. Filter Search (Judul)
        let filteredPlans = plans.filter(p => p.title.toLowerCase().includes(searchTerm));

        // 3. Logic Filter Dropdown
        if (filterVal === 'newest') {
            // Urutkan ID (Timestamp) dari Besar ke Kecil (Terbaru)
            filteredPlans.sort((a, b) => b.id - a.id);
        } 
        else if (filterVal === 'oldest') {
            // Urutkan ID Kecil ke Besar (Terlama)
            filteredPlans.sort((a, b) => a.id - b.id);
        }
        else if (filterVal === 'prio_urgent') {
            // Hanya ambil Priority Urgent atau High
            filteredPlans = filteredPlans.filter(p => p.priority === 'Urgent' || p.priority === 'High');
        }
        else if (filterVal === 'stat_exec') {
            filteredPlans = filteredPlans.filter(p => p.status === 'Eksekusi');
        }
        else if (filterVal === 'stat_success') {
            filteredPlans = filteredPlans.filter(p => p.status === 'Berhasil');
        }
        else if (filterVal === 'stat_idea') {
            filteredPlans = filteredPlans.filter(p => p.status === 'Idea' || p.status === 'Plan');
        }

        // 4. Cek Jika Kosong
        if(filteredPlans.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:rgba(255,255,255,0.5); padding:3rem;">Tidak ditemukan rencana dengan filter ini.</div>';
            return;
        }

       
        filteredPlans.forEach(plan => {
            const card = document.createElement('div');
            card.className = 'plan-card';
            
            // Gambar (Pakai Helper Static yang baru)
            const bgImage = getPlanImage(plan.category);

            // Warna Prioritas (Badge Kiri)
            let prioColor = '#94a3b8'; // Default Low
            let prioBg = 'rgba(148, 163, 184, 0.2)';
            if(plan.priority === 'Medium') { prioColor = '#3b82f6'; prioBg = 'rgba(59, 130, 246, 0.2)'; }
            if(plan.priority === 'High')   { prioColor = '#f59e0b'; prioBg = 'rgba(245, 158, 11, 0.2)'; }
            if(plan.priority === 'Urgent') { prioColor = '#ef4444'; prioBg = 'rgba(239, 68, 68, 0.2)'; }

            // Warna Status (Footer)
            let statusTextCol = '#a78bfa';
            if(plan.status === 'Berhasil') statusTextCol = '#10b981';
            if(plan.status === 'Eksekusi') statusTextCol = '#3b82f6';

            card.innerHTML = `
                <div style="height:160px; width:100%; position:relative;">
                    <img src="${bgImage}" 
                         style="width:100%; height:100%; object-fit:cover;" 
                         loading="lazy"
                         onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?auto=format&fit=crop&w=800&q=80';">
                    
                    <div style="position:absolute; top:10px; right:10px; display:flex; gap:5px;">
                         <button onclick="duplicatePlan(${plan.id}, event)" style="background:rgba(0,0,0,0.6); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-copy"></i></button>
                         <button onclick="deletePlan(${plan.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-trash"></i></button>
                    </div>
                </div>

                <div class="plan-card-body">
                    
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                        <span style="font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; background:${prioBg}; color:${prioColor}; padding:4px 10px; border-radius:20px; border:1px solid ${prioBg};">
                            ${plan.priority || 'Normal'}
                        </span>

                        <span style="font-size:0.7rem; font-weight:700; color:#a78bfa; text-transform:uppercase; letter-spacing:0.5px;">
                            ${plan.category}
                        </span>
                    </div>

                    <h3 class="plan-title" style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3;">${plan.title}</h3>
                    
                    <p style="font-size:0.9rem; color:#cbd5e1; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto; line-height:1.6;">
                        ${plan.desc || 'Tidak ada deskripsi singkat.'}
                    </p>
                    
                    <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
                         <span style="font-size:0.75rem; font-weight:600; color:${statusTextCol}; background:rgba(0,0,0,0.2); padding:4px 12px; border-radius:6px;">
                            ${plan.status}
                         </span>
                         <span style="font-size:0.8rem; color:#64748b;">
                            <i class="ph ph-calendar"></i> ${formatDate(plan.start)}
                         </span>
                    </div>
                </div>
            `;
            
            // Klik card untuk detail
            card.onclick = (e) => {
                // Pastikan klik tombol action tidak memicu detail view
                if(e.target.closest('button')) return;
                openPlanDetail(plan.id);
            };

            container.appendChild(card);
        });
    }
    // 3. Generate Milestones Input
    function generateMilestones() {
        const count = document.getElementById('inpMilestoneCount').value;
        const container = document.getElementById('milestoneContainer');
        container.innerHTML = '';
        if(count < 1) return;

        for(let i=1; i<=count; i++) {
            const div = document.createElement('div');
            div.className = 'milestone-item';
            div.style.cssText = "display:flex; gap:10px; align-items:center;";
            div.innerHTML = `
                <span style="color:#a78bfa; font-weight:bold;">${i}.</span>
                <input type="text" class="ms-input" placeholder="Langkah ke-${i}" style="flex:1; background:rgba(0,0,0,0.3); border:1px solid #4338ca; color:white; padding:8px; border-radius:6px;">
            `;
            container.appendChild(div);
        }
    }

    // 4. Save Plan
    // --- SAVE PLAN (DATA PENUH) ---
    function savePlan() {
        const id = document.getElementById('planId').value;
        
        // Helper ambil data array dinamis
        const getDynamicData = (type) => {
            const wrapper = document.getElementById(`wrapper${type}`);
            const items = wrapper.querySelectorAll('.dynamic-item');
            let res = [];
            items.forEach(item => {
                const name = item.querySelector('.field-name').value;
                const desc = item.querySelector('.field-desc').value;
                
                let obj = { name, desc };
                
                // Tambahan field khusus
                if(type === 'Goals') {
                    obj.start = item.querySelector('.field-start').value;
                    obj.end = item.querySelector('.field-end').value;
                }
                if(type === 'SubTasks') {
                    obj.target = item.querySelector('.field-target').value;
                    obj.progress = item.querySelector('.field-progress').value;
                }
                
                if(name) res.push(obj);
            });
            return res;
        };

        const dataObj = {
            id: id ? parseInt(id) : Date.now(),
            title: document.getElementById('inpPlanTitle').value,
            category: document.getElementById('inpPlanCategory').value,
            status: document.getElementById('inpPlanStatus').value,
            start: document.getElementById('inpPlanStart').value,
            startTime: document.getElementById('inpPlanStartTime').value,
            end: document.getElementById('inpPlanEnd').value,
            endTime: document.getElementById('inpPlanEndTime').value,
            owner: document.getElementById('inpPlanOwner').value,
            priority: document.getElementById('inpPlanPriority').value,
            team: document.getElementById('inpPlanTeam').value,
            media: document.getElementById('inpPlanMedia').value,
            type: document.getElementById('inpPlanType').value,
            desc: document.getElementById('inpPlanDesc').value,
            notes: document.getElementById('inpPlanNotes').value,
            
            // Data Dinamis Kompleks
            goals: getDynamicData('Goals'),
            impacts: getDynamicData('Impacts'),
            risks: getDynamicData('Risks'),
            mitigation: getDynamicData('Mitigation'),
            subTasks: getDynamicData('SubTasks'),
            milestones: getDynamicData('Milestones')
        };

        if(!dataObj.title) { alert("Judul wajib diisi"); return; }

        if(id) {
            const idx = plans.findIndex(x => x.id == id);
            plans[idx] = dataObj;
        } else {
            plans.push(dataObj);
        }

        localStorage.setItem('myPlans', JSON.stringify(plans));
        closePlanModal();
        renderPlans();
    }

    // --- CRUD ACTIONS ---
    function deletePlan(id, e) {
        e.stopPropagation();
        if(confirm("Hapus rencana ini?")) {
            plans = plans.filter(p => p.id !== id);
            localStorage.setItem('myPlans', JSON.stringify(plans));
            renderPlans();
        }
    }

    function duplicatePlan(id, e) {
        e.stopPropagation();
        const origin = plans.find(p => p.id === id);
        if(origin) {
            const copy = { ...origin, id: Date.now(), title: origin.title + " (Copy)", status: 'Idea' };
            plans.push(copy);
            localStorage.setItem('myPlans', JSON.stringify(plans));
            renderPlans();
        }
    }
    // 5. Open Detail / Read Logic
    let currentPlanId = null;

    function openPlanDetail(id) {
        const plan = plans.find(x => x.id === id);
        if(!plan) return;
        currentPlanId = id;
// LOAD GAMBAR KE DETAIL VIEW
        const imgEl = document.getElementById('viewPlanCover');
        
        // 1. Reset gambar dulu agar tidak menampilkan gambar sisa dari kartu sebelumnya
        imgEl.src = ''; 
        
        // 2. Tentukan Link Gambar Utama & Cadangan
        const mainImage = getPlanImage(plan.category);
        const backupImage = 'https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?auto=format&fit=crop&w=800&q=80'; // Gambar statis (Planning)

        // 3. Pasang "Satpam" Error lewat JS (Lebih Kuat dari HTML)
        imgEl.onerror = function() {
            this.onerror = null; // Cegah loop error berulang
            this.src = backupImage; // Langsung ganti ke gambar cadangan
        };

        // 4. Baru pasang link utamanya
        // (Sedikit delay agar transisi modal mulus)
        setTimeout(() => {
            imgEl.src = mainImage;
        }, 10);
        // Populate Text Dasar
        document.getElementById('viewPlanTitle').innerText = plan.title;
        document.getElementById('viewPlanCategory').innerText = plan.category;
        document.getElementById('viewPlanOwner').innerText = plan.owner || '-';
        document.getElementById('viewPlanPriority').innerText = plan.priority || 'Medium';
        document.getElementById('viewPlanTeam').innerText = plan.team || '-';
        document.getElementById('viewPlanMedia').innerText = plan.media || '-';
        document.getElementById('viewPlanType').innerText = plan.type || '-';
        
        // Waktu
        const startT = plan.startTime ? `, ${plan.startTime}` : '';
        const endT = plan.endTime ? `, ${plan.endTime}` : '';
        document.getElementById('viewPlanStart').innerText = `${formatDate(plan.start)}${startT}`;
        document.getElementById('viewPlanEnd').innerText = `${formatDate(plan.end)}${endT}`;

        document.getElementById('viewPlanDesc').innerText = plan.desc || "Tidak ada deskripsi.";
        document.getElementById('viewPlanNotes').innerText = plan.notes || "-";

        // Status Badge Style
        const badge = document.getElementById('viewPlanStatusBadge');
        badge.innerText = plan.status;
        if(plan.status === 'Berhasil') badge.style.cssText = "background:rgba(16, 185, 129, 0.2); color:#10b981; border:1px solid #10b981;";
        else if(plan.status === 'Eksekusi') badge.style.cssText = "background:rgba(59, 130, 246, 0.2); color:#3b82f6; border:1px solid #3b82f6;";
        else badge.style.cssText = "background:rgba(167, 139, 250, 0.2); color:#a78bfa; border:1px solid #a78bfa;";

        // --- HELPER RENDER LIST ITEM ---
        const renderList = (containerId, dataArray, type) => {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if(!dataArray || dataArray.length === 0) {
                container.innerHTML = '<div style="color:gray; font-style:italic;">Data kosong.</div>';
                return;
            }

            dataArray.forEach((item, idx) => {
                const row = document.createElement('div');
                // Style Glassy Purple
                row.style.cssText = "background: linear-gradient(145deg, rgba(49, 46, 129, 0.4), rgba(30, 27, 75, 0.4)); border:1px solid rgba(167, 139, 250, 0.15); padding:1rem; border-radius:10px; position:relative;";
                
                let extraInfo = '';
                
                // Custom Tampilan per Tipe
                if(type === 'Goals') {
                    const s = item.start ? formatDate(item.start) : '?';
                    const e = item.end ? formatDate(item.end) : '?';
                    extraInfo = `<div style="font-size:0.75rem; color:#a78bfa; margin-bottom:0.5rem; border-bottom:1px solid rgba(255,255,255,0.05); padding-bottom:5px;">Target: ${s}  ${e}</div>`;
                }
                else if(type === 'SubTasks') {
                    extraInfo = `
                        <div style="display:flex; justify-content:space-between; font-size:0.8rem; color:#94a3b8; margin-bottom:0.5rem; background:rgba(0,0,0,0.2); padding:5px 10px; border-radius:6px;">
                            <span>Target: <span style="color:white;">${item.target || '-'}</span></span>
                            <span>Progress: <span style="color:#34d399;">${item.progress || '0'}%</span></span>
                        </div>
                    `;
                }

                row.innerHTML = `
                    <strong style="display:block; color:#c4b5fd; font-size:0.95rem; margin-bottom:0.4rem;">#${idx+1} ${item.name}</strong>
                    ${extraInfo}
                    <div style="color:#cbd5e1; font-size:0.9rem; line-height:1.5; text-align:justify; white-space:pre-line;">${item.desc}</div>
                `;
                container.appendChild(row);
            });
        };

        // Render Semua List Dinamis
        renderList('viewListGoals', plan.goals, 'Goals');
        renderList('viewListImpacts', plan.impacts, 'Impacts');
        renderList('viewListRisks', plan.risks, 'Risks');
        renderList('viewListMitigation', plan.mitigation, 'Mitigation');
        renderList('viewListSubTasks', plan.subTasks, 'SubTasks');
        renderList('viewListMilestones', plan.milestones, 'Milestones');

        // UI Switch
        document.getElementById('planModalTitle').innerText = "Detail Plan";
        document.getElementById('planForm').classList.add('hidden');
        document.getElementById('planDetailView').classList.remove('hidden');
        document.getElementById('planFormActions').classList.add('hidden');
        document.getElementById('planDetailActions').classList.remove('hidden');
        document.getElementById('planModalOverlay').classList.add('active');
    }
    // 6. Edit Logic
    // --- 6. EDIT PLAN LOGIC (REVISI KOMPATIBEL DENGAN FORM BARU) ---
    
    // Helper untuk memuat data dinamis kembali ke form saat Edit
    function loadDynamicEditFields(type, dataArray) {
        const wrapper = document.getElementById(`wrapper${type}`);
        const countInput = document.getElementById(`count${type}`);
        
        wrapper.innerHTML = ''; // Bersihkan dulu
        
        if (!dataArray || dataArray.length === 0) {
            countInput.value = "";
            return;
        }

        countInput.value = dataArray.length;

        dataArray.forEach((item, i) => {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                             <strong style="display:block; color:#a78bfa; margin-bottom:5px;">${type} #${i+1}</strong>`;

            // Render Input sesuai tipe, lalu isi VALUE-nya dari data yang ada
            if(type === 'Goals') {
                div.innerHTML += `
                    <input type="text" class="field-name" value="${item.name || ''}" placeholder="Nama Goal">
                    <div style="display:flex; gap:5px;">
                        <input type="date" class="field-start" value="${item.start || ''}">
                        <input type="date" class="field-end" value="${item.end || ''}">
                    </div>
                    <textarea class="field-desc" placeholder="Deskripsi Goal">${item.desc || ''}</textarea>
                `;
            } else if(type === 'SubTasks') {
                div.innerHTML += `
                    <input type="text" class="field-name" value="${item.name || ''}" placeholder="Nama Sub-Tugas">
                    <input type="text" class="field-target" value="${item.target || ''}" placeholder="Target Output">
                    <input type="text" class="field-progress" value="${item.progress || ''}" placeholder="Progress (%)">
                    <textarea class="field-desc" placeholder="Deskripsi Tugas">${item.desc || ''}</textarea>
                `;
            } else {
                // Risk, Impact, Mitigation, Milestones
                div.innerHTML += `
                    <input type="text" class="field-name" value="${item.name || ''}" placeholder="Nama ${type}">
                    <textarea class="field-desc" placeholder="Deskripsi ${type}">${item.desc || ''}</textarea>
                `;
            }
            wrapper.appendChild(div);
        });
    }

    function editPlan() {
        const plan = plans.find(x => x.id === currentPlanId);
        if(!plan) return;

        // 1. Load Data Statis
        document.getElementById('planId').value = plan.id;
        document.getElementById('inpPlanTitle').value = plan.title;
        document.getElementById('inpPlanCategory').value = plan.category;
        document.getElementById('inpPlanStatus').value = plan.status;
        
        document.getElementById('inpPlanStart').value = plan.start;
        document.getElementById('inpPlanStartTime').value = plan.startTime || '';
        document.getElementById('inpPlanEnd').value = plan.end;
        document.getElementById('inpPlanEndTime').value = plan.endTime || '';
        
        document.getElementById('inpPlanOwner').value = plan.owner || '';
        document.getElementById('inpPlanPriority').value = plan.priority || 'Medium';
        document.getElementById('inpPlanTeam').value = plan.team || 'Individu';
        document.getElementById('inpPlanMedia').value = plan.media || '';
        document.getElementById('inpPlanType').value = plan.type || '';
        
        document.getElementById('inpPlanDesc').value = plan.desc || '';
        document.getElementById('inpPlanNotes').value = plan.notes || '';

        // 2. Load Data Dinamis (Goals, Risks, dll)
        loadDynamicEditFields('Goals', plan.goals);
        loadDynamicEditFields('Impacts', plan.impacts);
        loadDynamicEditFields('Risks', plan.risks);
        loadDynamicEditFields('Mitigation', plan.mitigation);
        loadDynamicEditFields('SubTasks', plan.subTasks);
        loadDynamicEditFields('Milestones', plan.milestones);

        // 3. Switch UI
        document.getElementById('planModalTitle').innerText = "Edit Plan";
        document.getElementById('planDetailView').classList.add('hidden');
        document.getElementById('planForm').classList.remove('hidden');
        document.getElementById('planDetailActions').classList.add('hidden');
        document.getElementById('planFormActions').classList.remove('hidden');
    }

    // --- UTILS PLANS ---
    
    function openPlanModal() {
        // 1. Reset Form Dasar
        document.getElementById('planForm').reset();
        document.getElementById('planId').value = '';
        
        // 2. Bersihkan Semua Wrapper Dinamis (Agar sisa edit sebelumnya hilang)
        const dynamicTypes = ['Goals', 'Impacts', 'Risks', 'Mitigation', 'SubTasks', 'Milestones'];
        dynamicTypes.forEach(type => {
            document.getElementById(`wrapper${type}`).innerHTML = '';
            document.getElementById(`count${type}`).value = '';
        });

        // 3. Switch UI
        document.getElementById('planModalTitle').innerText = "New Plan";
        document.getElementById('planForm').classList.remove('hidden');
        document.getElementById('planDetailView').classList.add('hidden');
        document.getElementById('planFormActions').classList.remove('hidden');
        document.getElementById('planDetailActions').classList.add('hidden');
        document.getElementById('planModalOverlay').classList.add('active');
    }

    function closePlanModal() {
        document.getElementById('planModalOverlay').classList.remove('active');
    }
    function closePlanModal() {
        document.getElementById('planModalOverlay').classList.remove('active');
    }

    // Panggil render saat awal (opsional, atau panggil di navigate)
    renderPlans();


// --- LOGIKA FITUR JOURNAL (WARM THEME) ---

    // 1. SETUP GAMBAR KATEGORI JOURNAL (20 ITEM - STATIC LINKS)
    const journalCategoryAssets = {
        "Reflection": "https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80",
        "Gratitude": "https://images.unsplash.com/photo-1507608616759-54f48f0af0ee?w=800&q=80",
        "Dream Diary": "https://images.unsplash.com/photo-1496347312952-658252276587?w=800&q=80",
        "Travel Log": "https://images.unsplash.com/photo-1476514525535-07fb3b4ae5f1?w=800&q=80",
        "Food & Recipe": "https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=800&q=80",
        "Workout": "https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=800&q=80",
        "Reading": "https://images.unsplash.com/photo-1512820790803-83ca734da794?w=800&q=80",
        "Mood Tracker": "https://images.unsplash.com/photo-1504198458649-3128b932f49e?w=800&q=80",
        "Productivity": "https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=800&q=80",
        "Learning": "https://images.unsplash.com/photo-1503676260728-1c00da094a0b?w=800&q=80",
        "Family": "https://images.unsplash.com/photo-1511895426328-dc8714191300?w=800&q=80",
        "Friends": "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=800&q=80",
        "Relationship": "https://images.unsplash.com/photo-1516585427167-9f4af9627e6c?w=800&q=80",
        "Finances": "https://images.unsplash.com/photo-1579621970563-ebec7560eb3e?w=800&q=80",
        "Ideas": "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&q=80",
        "Work": "https://images.unsplash.com/photo-1497215728101-856f4ea42174?w=800&q=80",
        "Health": "https://images.unsplash.com/photo-1505751172876-fa1923c5c528?w=800&q=80",
        "Nature": "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=800&q=80",
        "Art & Sketch": "https://images.unsplash.com/photo-1513364776144-60967b0f800f?w=800&q=80",
        "Music": "https://images.unsplash.com/photo-1511379938547-c1f69419868d?w=800&q=80"
    };

    // Helper Image Journal
    function getJournalImage(cat) {
        return journalCategoryAssets[cat] || "https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80";
    }

    // Populate Dropdown Journal
    const jCatSelect = document.getElementById('inpJCategory');
    if(jCatSelect) {
        Object.keys(journalCategoryAssets).sort().forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat; opt.innerText = cat;
            jCatSelect.appendChild(opt);
        });
    }

    // Init Data
    let journals = JSON.parse(localStorage.getItem('myJournals')) || [];

    // --- GENERATOR SUB DAILY JOURNAL (Fields: Nama, Date, Time, Desc) ---
    function generateSubJournalFields() {
        const count = document.getElementById('countSubJournal').value;
        const wrapper = document.getElementById('wrapperSubJournal');
        wrapper.innerHTML = '';
        if(count < 1) return;

        for(let i=1; i<=count; i++) {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                             <strong style="display:block; color:#fda4af; margin-bottom:5px;">Aktivitas #${i}</strong>`;
            
            div.innerHTML += `
                <input type="text" class="field-name" placeholder="Nama Aktivitas">
                <div style="display:flex; gap:5px;">
                    <input type="date" class="field-date">
                    <input type="time" class="field-time">
                </div>
                <textarea class="field-desc" placeholder="Deskripsi Aktivitas"></textarea>
            `;
            wrapper.appendChild(div);
        }
    }

    // --- RENDER JOURNAL CARD (SEARCH & FILTER) ---
    function renderJournals() {
        const container = document.getElementById('journalsContainer');
        const searchTerm = document.getElementById('inpSearchJournal') ? document.getElementById('inpSearchJournal').value.toLowerCase() : "";
        const filterVal = document.getElementById('inpJournalFilter') ? document.getElementById('inpJournalFilter').value : "newest";
        
        container.innerHTML = '';
        let filtered = journals.filter(j => j.title.toLowerCase().includes(searchTerm));

        // Logic Filter
        if(filterVal === 'newest') filtered.sort((a,b) => b.id - a.id);
        if(filterVal === 'oldest') filtered.sort((a,b) => a.id - b.id);
        if(filterVal === 'imp_very') filtered = filtered.filter(j => j.priority === 'Sangat Penting');
        if(filterVal === 'imp_yes') filtered = filtered.filter(j => j.priority === 'Penting');
        if(filterVal === 'stat_done') filtered = filtered.filter(j => j.status === 'Selesai');
        if(filterVal === 'stat_doing') filtered = filtered.filter(j => j.status === 'Dilakukan');

        if(filtered.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:rgba(255,255,255,0.5); padding:3rem;">Tidak ditemukan jurnal.</div>';
            return;
        }

        filtered.forEach(j => {
            const card = document.createElement('div');
            card.className = 'journal-card';
            const bgImage = getJournalImage(j.category);

            // Warna Prioritas
            let prioColor = '#d1d5db'; let prioBg = 'rgba(255,255,255,0.1)';
            if(j.priority === 'Sangat Penting') { prioColor = '#f87171'; prioBg = 'rgba(248, 113, 113, 0.2)'; }
            else if(j.priority === 'Penting') { prioColor = '#fbbf24'; prioBg = 'rgba(251, 191, 36, 0.2)'; }

            // Warna Status
            let statColor = '#fda4af';
            if(j.status === 'Selesai') statColor = '#34d399';
            if(j.status === 'Dilakukan') statColor = '#60a5fa';

            card.innerHTML = `
                <div style="height:160px; width:100%; position:relative;">
                    <img src="${bgImage}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80';">
                    <div style="position:absolute; top:10px; right:10px; display:flex; gap:5px;">
                         <button onclick="duplicateJournal(${j.id}, event)" style="background:rgba(0,0,0,0.6); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-copy"></i></button>
                         <button onclick="deleteJournal(${j.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-trash"></i></button>
                    </div>
                </div>

                <div class="journal-card-body">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                        <span class="badge-j-prio" style="color:${prioColor}; background:${prioBg}; border:1px solid ${prioBg};">${j.priority}</span>
                        <span style="font-size:0.7rem; font-weight:700; color:#fda4af; text-transform:uppercase;">${j.category}</span>
                    </div>

                    <h3 style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3; color:white;">${j.title}</h3>
                    <p style="font-size:0.9rem; color:#d1d5db; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto; line-height:1.6;">
                        ${j.desc || 'Belum ada cerita...'}
                    </p>

                    <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                         <span class="badge-j-stat" style="color:${statColor}; border:1px solid ${statColor};">${j.status}</span>
                         <span style="font-size:0.8rem; color:#9ca3af;">
                            <i class="ph ph-calendar"></i> ${formatDate(j.date)}
                         </span>
                    </div>
                </div>
            `;
            
            card.onclick = (e) => {
                if(e.target.closest('button')) return;
                openJournalDetail(j.id);
            };
            container.appendChild(card);
        });
    }

    // --- SAVE JOURNAL ---
    function saveJournal() {
        const id = document.getElementById('journalId').value;
        
        // Ambil Data Sub Journal
        const wrapper = document.getElementById('wrapperSubJournal');
        const items = wrapper.querySelectorAll('.dynamic-item');
        let subData = [];
        items.forEach(item => {
            const name = item.querySelector('.field-name').value;
            const date = item.querySelector('.field-date').value;
            const time = item.querySelector('.field-time').value;
            const desc = item.querySelector('.field-desc').value;
            if(name) subData.push({ name, date, time, desc });
        });

        const dataObj = {
            id: id ? parseInt(id) : Date.now(),
            title: document.getElementById('inpJTitle').value,
            owner: document.getElementById('inpJOwner').value,
            category: document.getElementById('inpJCategory').value,
            date: document.getElementById('inpJDate').value,
            time: document.getElementById('inpJTime').value,
            team: document.getElementById('inpJTeam').value,
            status: document.getElementById('inpJStatus').value,
            priority: document.getElementById('inpJPriority').value,
            media: document.getElementById('inpJMedia').value,
            link: document.getElementById('inpJLink').value,
            desc: document.getElementById('inpJDesc').value,
            notes: document.getElementById('inpJNotes').value,
            subJournals: subData
        };

        if(!dataObj.title) { alert("Judul wajib diisi!"); return; }

        if(id) {
            const idx = journals.findIndex(x => x.id == id);
            journals[idx] = dataObj;
        } else {
            journals.push(dataObj);
        }

        localStorage.setItem('myJournals', JSON.stringify(journals));
        closeJournalModal();
        renderJournals();
    }

    // --- OPEN DETAIL JOURNAL ---
    let currentJournalId = null;
    function openJournalDetail(id) {
        const j = journals.find(x => x.id === id);
        if(!j) return;
        currentJournalId = id;

        // Image Logic
        const imgEl = document.getElementById('viewJCover');
        imgEl.src = ''; 
        const mainImage = getJournalImage(j.category);
        const backupImage = 'https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80';
        imgEl.onerror = function() { this.onerror = null; this.src = backupImage; };
        setTimeout(() => { imgEl.src = mainImage; }, 10);

        // Populate Text
        document.getElementById('viewJTitle').innerText = j.title;
        document.getElementById('viewJCategory').innerText = j.category;
        document.getElementById('viewJOwner').innerText = j.owner || '-';
        document.getElementById('viewJTeam').innerText = j.team || '-';
        document.getElementById('viewJMedia').innerText = j.media || '-';
        document.getElementById('viewJDate').innerText = formatDate(j.date);
        document.getElementById('viewJTime').innerText = j.time || '-';
        document.getElementById('viewJDesc').innerText = j.desc || '-';
        document.getElementById('viewJNotes').innerText = j.notes || '-';
        
        // Link
        const lnk = document.getElementById('viewJLink');
        if(j.link) { lnk.href = j.link; lnk.style.display='block'; } else { lnk.style.display='none'; }

        // Badges
        const statB = document.getElementById('viewJStatusBadge');
        statB.className = 'badge-j-stat';
        statB.innerText = j.status;
        if(j.status === 'Selesai') statB.style.cssText = "color:#34d399; border:1px solid #34d399; padding:4px 12px; border-radius:6px;";
        else statB.style.cssText = "color:#fda4af; border:1px solid #fda4af; padding:4px 12px; border-radius:6px;";

        const prioB = document.getElementById('viewJPriority');
        prioB.innerText = j.priority;

        // Render Sub Journals
        const subCont = document.getElementById('viewListSubJournal');
        subCont.innerHTML = '';
        if(j.subJournals && j.subJournals.length > 0) {
            j.subJournals.forEach((sub, i) => {
                const row = document.createElement('div');
                row.style.cssText = "background: linear-gradient(145deg, rgba(69, 10, 10, 0.4), rgba(127, 29, 29, 0.4)); border:1px solid rgba(251, 113, 133, 0.15); padding:1rem; border-radius:10px;";
                row.innerHTML = `
                    <strong style="display:block; color:#fda4af; font-size:0.95rem; margin-bottom:0.4rem;">#${i+1} ${sub.name}</strong>
                    <div style="font-size:0.75rem; color:#fb7185; margin-bottom:0.5rem; border-bottom:1px solid rgba(255,255,255,0.05); padding-bottom:5px;">
                        Waktu: ${formatDate(sub.date)} jam ${sub.time || '-'}
                    </div>
                    <div style="color:#e5e7eb; font-size:0.9rem;">${sub.desc}</div>
                `;
                subCont.appendChild(row);
            });
        } else {
            subCont.innerHTML = '<div style="color:gray; font-style:italic;">Tidak ada aktivitas sub.</div>';
        }

        // Switch UI
        document.getElementById('journalModalTitle').innerText = "Detail Journal";
        document.getElementById('journalForm').classList.add('hidden');
        document.getElementById('journalDetailView').classList.remove('hidden');
        document.getElementById('journalFormActions').classList.add('hidden');
        document.getElementById('journalDetailActions').classList.remove('hidden');
        document.getElementById('journalModalOverlay').classList.add('active');
    }

    // --- EDIT & DELETE & UTILS ---
    function editJournal() {
        const j = journals.find(x => x.id === currentJournalId);
        if(!j) return;
        
        document.getElementById('journalId').value = j.id;
        document.getElementById('inpJTitle').value = j.title;
        document.getElementById('inpJOwner').value = j.owner;
        document.getElementById('inpJCategory').value = j.category;
        document.getElementById('inpJDate').value = j.date;
        document.getElementById('inpJTime').value = j.time;
        document.getElementById('inpJTeam').value = j.team;
        document.getElementById('inpJStatus').value = j.status;
        document.getElementById('inpJPriority').value = j.priority;
        document.getElementById('inpJMedia').value = j.media;
        document.getElementById('inpJLink').value = j.link;
        document.getElementById('inpJDesc').value = j.desc;
        document.getElementById('inpJNotes').value = j.notes;

        // Load Sub Journals
        const wrapper = document.getElementById('wrapperSubJournal');
        wrapper.innerHTML = '';
        if(j.subJournals) {
            document.getElementById('countSubJournal').value = j.subJournals.length;
            j.subJournals.forEach((sub, i) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                                 <strong style="display:block; color:#fda4af; margin-bottom:5px;">Aktivitas #${i+1}</strong>`;
                div.innerHTML += `
                    <input type="text" class="field-name" value="${sub.name}" placeholder="Nama Aktivitas">
                    <div style="display:flex; gap:5px;">
                        <input type="date" class="field-date" value="${sub.date}">
                        <input type="time" class="field-time" value="${sub.time}">
                    </div>
                    <textarea class="field-desc" placeholder="Deskripsi Aktivitas">${sub.desc}</textarea>
                `;
                wrapper.appendChild(div);
            });
        }

        document.getElementById('journalModalTitle').innerText = "Edit Journal";
        document.getElementById('journalDetailView').classList.add('hidden');
        document.getElementById('journalForm').classList.remove('hidden');
        document.getElementById('journalDetailActions').classList.add('hidden');
        document.getElementById('journalFormActions').classList.remove('hidden');
    }

    function deleteJournal(id, e) {
        e.stopPropagation();
        if(confirm("Hapus jurnal ini?")) {
            journals = journals.filter(x => x.id !== id);
            localStorage.setItem('myJournals', JSON.stringify(journals));
            renderJournals();
        }
    }

    function duplicateJournal(id, e) {
        e.stopPropagation();
        const origin = journals.find(x => x.id === id);
        if(origin) {
            const copy = { ...origin, id: Date.now(), title: origin.title + " (Copy)" };
            journals.push(copy);
            localStorage.setItem('myJournals', JSON.stringify(journals));
            renderJournals();
        }
    }

    function openJournalModal() {
        document.getElementById('journalForm').reset();
        document.getElementById('journalId').value = '';
        document.getElementById('wrapperSubJournal').innerHTML = '';
        document.getElementById('countSubJournal').value = '';

        document.getElementById('journalModalTitle').innerText = "New Journal";
        document.getElementById('journalForm').classList.remove('hidden');
        document.getElementById('journalDetailView').classList.add('hidden');
        document.getElementById('journalFormActions').classList.remove('hidden');
        document.getElementById('journalDetailActions').classList.add('hidden');
        document.getElementById('journalModalOverlay').classList.add('active');
    }

    function closeJournalModal() {
        document.getElementById('journalModalOverlay').classList.remove('active');
    }

// --- LOGIKA DASHBOARD (MASTER AGGREGATOR) ---

    function renderDashboard() {
        const container = document.getElementById('dashboardContainer');
        const searchTerm = document.getElementById('inpSearchDash') ? document.getElementById('inpSearchDash').value.toLowerCase() : "";
        const filterType = document.getElementById('inpDashFilter') ? document.getElementById('inpDashFilter').value : "all";
        
        container.innerHTML = '';

        // 1. Ambil Semua Data & Beri Label Tipe
        // Kita copy array agar array asli tidak terganggu
        const allIdeas = (JSON.parse(localStorage.getItem('myIdeas')) || []).map(i => ({...i, dataType: 'idea'}));
        const allPlans = (JSON.parse(localStorage.getItem('myPlans')) || []).map(p => ({...p, dataType: 'plan'}));
        const allJournals = (JSON.parse(localStorage.getItem('myJournals')) || []).map(j => ({...j, dataType: 'journal'}));
        const allNotulensis = (JSON.parse(localStorage.getItem('myNotulensis')) || []).map(n => ({...n, dataType: 'notulensi'}));

        // 2. Gabungkan Jadi Satu Array Master
      let masterData = [...allIdeas, ...allPlans, ...allJournals, ...allNotulensis];
        // 3. Filter Search Global (Cek Judul)
        if(searchTerm) {
            masterData = masterData.filter(item => item.title.toLowerCase().includes(searchTerm));
        }

        // 4. Filter Dropdown Tipe
        if(filterType !== 'all') {
            masterData = masterData.filter(item => item.dataType === filterType);
        }

        // 5. Sorting: Waktu Terbaru (ID biasanya timestamp, jadi aman dipake sort)
        masterData.sort((a, b) => b.id - a.id);

        // Update Statistik Kecil
        if(document.getElementById('statTotal')) {
            document.getElementById('statTotal').innerText = masterData.length;
        }

        // 6. Cek Kosong
        if(masterData.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:rgba(255,255,255,0.5); padding:5rem;">Tidak ada item ditemukan di Dashboard.</div>';
            return;
        }

        // 7. RENDER LOOP (Switch Style Berdasarkan Tipe)
        masterData.forEach(item => {
            const card = document.createElement('div');
            
            // --- A. JIKA TIPE IDEA (Style Hijau/Teal) ---
       // --- A. JIKA TIPE IDEA (Revisi: Style Premium Full Bleed - Hijau/Teal) ---
            if(item.dataType === 'idea') {
                // Gunakan class 'plan-card' sebagai base agar dapat properti rounded & overflow hidden
                // Tapi kita timpa backgroundnya jadi Hijau/Teal khas Idea
            card.className = 'card';
                
                // Override background jadi nuansa Teal/Emerald
                card.style.background = 'linear-gradient(160deg, rgba(6, 78, 59, 0.6) 0%, rgba(4, 47, 46, 0.8) 100%)';
                card.style.borderColor = 'rgba(52, 211, 153, 0.2)';

                // Logic Gambar & Status
                const displayImg = item.img && item.img.trim() !== '' ? item.img : getCategoryImage(item.category);
                
                let statusColor = '#94a3b8'; // Default
                let statusBg = 'rgba(148, 163, 184, 0.2)';
                
                if(item.status === 'Sudah Selesai') { 
                    statusColor = '#10b981'; statusBg = 'rgba(16, 185, 129, 0.2)';
                } 
                if(item.status === 'Dikerjakan') { 
                    statusColor = '#3b82f6'; statusBg = 'rgba(59, 130, 246, 0.2)';
                }
                if(item.status === 'Pending') { 
                    statusColor = '#f59e0b'; statusBg = 'rgba(245, 158, 11, 0.2)';
                }

                card.innerHTML = `
                    <div style="height:160px; width:100%; position:relative;">
                        <span class="card-source-badge badge-src-idea">Idea</span>
                        
                        <img src="${displayImg}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1550684848-fac1c5b4e853?w=800&q=80'">
                        
                        <div style="position:absolute; top:10px; right:10px;">
                             <button onclick="deleteIdea(${item.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>

                    <div class="plan-card-body"> <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                            <span style="font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; background:${statusBg}; color:${statusColor}; padding:4px 10px; border-radius:20px; border:1px solid ${statusBg};">
                                ${item.status || 'Draft'}
                            </span>
                            <span style="font-size:0.7rem; font-weight:700; color:#34d399; text-transform:uppercase;">
                                ${item.category}
                            </span>
                        </div>

                        <h3 class="card-title" style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3; color:white;">${item.title}</h3>
                        <p style="font-size:0.9rem; color:#d1d5db; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto; line-height:1.6;">
                            ${item.desc}
                        </p>

                        <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                            <span style="font-size:0.8rem; color:#9ca3af; font-style:italic;">
                                ${item.importance || ''}
                            </span>
                            <span style="font-size:0.8rem; color:#9ca3af;">
                                <i class="ph ph-calendar"></i> ${formatDate(item.createdAt || item.id)}
                            </span>
                        </div>
                    </div>
                `;
              
                // Klik Card Idea membuka Form Edit (Kecuali klik tombol hapus)
                card.onclick = (e) => { 
                    if(!e.target.closest('button')) {
                        // Kita panggil fungsi edit idea yang sudah ada
                        // (Pastikan fungsi openDetailView atau openFormModal Idea kamu siap)
                        if(typeof openDetailView === 'function') openDetailView(item.id); 
                        else if(typeof openFormModal === 'function') {
                            // Manual load data to form for Idea editing
                             document.getElementById('inpId').value = item.id;
                             document.getElementById('inpTitle').value = item.title;
                             document.getElementById('inpDesc').value = item.desc;
                             document.getElementById('inpCategory').value = item.category;
                             // dst... lalu buka modal
                             openFormModal();
                        }
                    } 
                };
            }
            // --- B. JIKA TIPE PLAN (Style Ungu/Full Bleed) ---
            else if(item.dataType === 'plan') {
                card.className = 'plan-card'; // Style asli Plan
                const bgImage = getPlanImage(item.category);
                
                let prioBg = 'rgba(148, 163, 184, 0.2)'; let prioColor = '#94a3b8';
                if(item.priority === 'High') { prioBg='rgba(245, 158, 11, 0.2)'; prioColor='#f59e0b'; }
                if(item.priority === 'Urgent') { prioBg='rgba(239, 68, 68, 0.2)'; prioColor='#ef4444'; }

                card.innerHTML = `
                    <div style="height:160px; width:100%; position:relative;">
                        <span class="card-source-badge badge-src-plan">Plan</span>
                        <img src="${bgImage}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1484480974693-6ca0a78fb36b?w=800&q=80';">
                        <div style="position:absolute; top:10px; right:10px;">
                             <button onclick="deletePlan(${item.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                    <div class="plan-card-body">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                            <span style="font-size:0.65rem; font-weight:700; text-transform:uppercase; letter-spacing:1px; background:${prioBg}; color:${prioColor}; padding:4px 10px; border-radius:20px; border:1px solid ${prioBg};">${item.priority || 'Normal'}</span>
                            <span style="font-size:0.7rem; font-weight:700; color:#a78bfa; text-transform:uppercase;">${item.category}</span>
                        </div>
                        <h3 class="plan-title" style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3;">${item.title}</h3>
                        <p style="font-size:0.9rem; color:#cbd5e1; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto;">${item.desc || '-'}</p>
                        <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.05); display:flex; justify-content:space-between; align-items:center;">
                             <span style="font-size:0.75rem; font-weight:600; color:#a78bfa; background:rgba(0,0,0,0.2); padding:4px 12px; border-radius:6px;">${item.status}</span>
                             <span style="font-size:0.8rem; color:#64748b;">${formatDate(item.start)}</span>
                        </div>
                    </div>
                `;
                // Klik Card membuka Detail Plan
                card.onclick = (e) => { if(!e.target.closest('button')) openPlanDetail(item.id); };
            }

            // --- C. JIKA TIPE JOURNAL (Style Merah/Sunset) ---
            else if(item.dataType === 'journal') {
                card.className = 'journal-card'; // Style asli Journal
                const bgImage = getJournalImage(item.category);
                
                card.innerHTML = `
                    <div style="height:160px; width:100%; position:relative;">
                        <span class="card-source-badge badge-src-journal">Journal</span>
                        <img src="${bgImage}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1517842645767-c639042777db?w=800&q=80';">
                        <div style="position:absolute; top:10px; right:10px;">
                             <button onclick="deleteJournal(${item.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px; cursor:pointer; backdrop-filter:blur(4px);"><i class="ph ph-trash"></i></button>
                        </div>
                    </div>
                    <div class="journal-card-body">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                            <span class="badge-j-prio" style="color:#fbbf24; background:rgba(251, 191, 36, 0.2); border:1px solid rgba(251, 191, 36, 0.2);">${item.priority}</span>
                            <span style="font-size:0.7rem; font-weight:700; color:#fda4af; text-transform:uppercase;">${item.category}</span>
                        </div>
                        <h3 style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3; color:white;">${item.title}</h3>
                        <p style="font-size:0.9rem; color:#d1d5db; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto;">${item.desc || '...'}</p>
                        <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                             <span class="badge-j-stat" style="color:#fda4af; border:1px solid #fda4af;">${item.status}</span>
                             <span style="font-size:0.8rem; color:#9ca3af;">${formatDate(item.date)}</span>
                        </div>
                    </div>
                `;
                // Klik Card membuka Detail Journal
                card.onclick = (e) => { if(!e.target.closest('button')) openJournalDetail(item.id); };
            }
            // --- D. JIKA TIPE NOTULENSI (Style Navy/Ocean) ---
        else if(item.dataType === 'notulensi') {
            card.className = 'notulensi-card';
            const bgImage = getNotulensiImage(item.category);

            card.innerHTML = `
                <div style="height:160px; width:100%; position:relative;">
                    <span class="card-source-badge badge-src-notulensi">Notulensi</span>
                    <img src="${bgImage}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.src='https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&q=80'">
                    <div style="position:absolute; top:10px; right:10px;">
                         <button onclick="deleteNotulensi(${item.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px;"><i class="ph ph-trash"></i></button>
                    </div>
                </div>
                <div class="notulensi-card-body">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                        <span class="badge-n-imp" style="background:rgba(255,255,255,0.1); color:#7dd3fc; border:1px solid rgba(56,189,248,0.2);">${item.category}</span>
                        <span style="font-size:0.7rem; font-weight:700; color:#38bdf8; text-transform:uppercase;">${item.status}</span>
                    </div>
                    <h3 style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3; color:white;">${item.title}</h3>
                    <p style="font-size:0.9rem; color:#cbd5e1; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto;">${item.desc || '-'}</p>
                    <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                         <span style="font-size:0.75rem; color:#94a3b8;">${item.leader}</span>
                         <span style="font-size:0.8rem; color:#94a3b8;">${formatDate(item.date)}</span>
                    </div>
                </div>
            `;
            card.onclick = (e) => { if(!e.target.closest('button')) openNotulensiDetail(item.id); };
        }

            container.appendChild(card);
        });
    }
    // --- LOGIKA FITUR NOTULENSI (OCEANIC THEME) ---

    // 1. ASSETS GAMBAR NOTULENSI (20 Kategori)
    const notulensiCategoryAssets = {
        "Strategi": "https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?w=800&q=80",
        "Operasional": "https://images.unsplash.com/photo-1581091226825-a6a2a5aee158?w=800&q=80",
        "HR": "https://images.unsplash.com/photo-1521737604893-d14cc237f11d?w=800&q=80",
        "Marketing": "https://images.unsplash.com/photo-1533750516457-a7f992034fec?w=800&q=80",
        "Finance": "https://images.unsplash.com/photo-1554224155-984063584d45?w=800&q=80",
        "IT & Tech": "https://images.unsplash.com/photo-1518770660439-4636190af475?w=800&q=80",
        "Product": "https://images.unsplash.com/photo-1504868584819-f8e8b4b6d7e3?w=800&q=80",
        "Sales": "https://images.unsplash.com/photo-1556761175-5973dc0f32e7?w=800&q=80",
        "Legal": "https://images.unsplash.com/photo-1589829085413-56de8ae18c73?w=800&q=80",
        "Partnership": "https://images.unsplash.com/photo-1560250097-0b93528c311a?w=800&q=80",
        "Board": "https://images.unsplash.com/photo-1556761175-4b46a572b786?w=800&q=80",
        "General": "https://images.unsplash.com/photo-1497215728101-856f4ea42174?w=800&q=80",
        "Project": "https://images.unsplash.com/photo-1507925921958-8a62f3d1a50d?w=800&q=80",
        "Creative": "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?w=800&q=80",
        "Evaluation": "https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&q=80",
        "Training": "https://images.unsplash.com/photo-1524178232363-1fb2b075b655?w=800&q=80",
        "Public Relations": "https://images.unsplash.com/photo-1557804506-669a67965ba0?w=800&q=80",
        "R&D": "https://images.unsplash.com/photo-1532094349884-543bc11b234d?w=800&q=80",
        "Customer Service": "https://images.unsplash.com/photo-1516321318423-f06f85e504b3?w=800&q=80",
        "Logistics": "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?w=800&q=80"
    };

    function getNotulensiImage(cat) {
        return notulensiCategoryAssets[cat] || "https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&q=80";
    }

    // Populate Dropdown
    const nCatSelect = document.getElementById('inpNCategory');
    if(nCatSelect) {
        Object.keys(notulensiCategoryAssets).sort().forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat; opt.innerText = cat;
            nCatSelect.appendChild(opt);
        });
    }

    let notulensis = JSON.parse(localStorage.getItem('myNotulensis')) || [];

    // --- GENERATOR ACTION ITEMS (SUB-ITEM) ---
    function generateActionFields() {
        const count = document.getElementById('countActionItems').value;
        const wrapper = document.getElementById('wrapperActionItems');
        wrapper.innerHTML = '';
        if(count < 1) return;

        for(let i=1; i<=count; i++) {
            const div = document.createElement('div');
            div.className = 'dynamic-item';
            div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                             <strong style="display:block; color:#7dd3fc; margin-bottom:5px;">Action Item #${i}</strong>`;
            
            div.innerHTML += `
                <input type="text" class="field-name" placeholder="Nama Aktivitas">
                <div style="display:flex; gap:5px;">
                    <input type="date" class="field-date">
                    <input type="time" class="field-time">
                </div>
                <div style="display:flex; gap:5px;">
                    <input type="text" class="field-pic" placeholder="PIC Name">
                    <select class="field-status" style="background:rgba(0,0,0,0.3); border:1px solid #38bdf8; color:white; border-radius:6px;">
                        <option>To Do</option><option>In Progress</option><option>Done</option>
                    </select>
                </div>
                <textarea class="field-desc" placeholder="Deskripsi Aktivitas"></textarea>
            `;
            wrapper.appendChild(div);
        }
    }

    // --- RENDER NOTULENSI ---
    function renderNotulensi() {
        const container = document.getElementById('notulensiContainer');
        const searchTerm = document.getElementById('inpSearchNotulensi') ? document.getElementById('inpSearchNotulensi').value.toLowerCase() : "";
        const filterVal = document.getElementById('inpNotulensiFilter') ? document.getElementById('inpNotulensiFilter').value : "newest";
        
        container.innerHTML = '';
        let filtered = notulensis.filter(n => n.title.toLowerCase().includes(searchTerm));

        // Logic Filter
        if(filterVal === 'newest') filtered.sort((a,b) => b.id - a.id);
        if(filterVal === 'oldest') filtered.sort((a,b) => a.id - b.id);
        if(filterVal === 'imp_very') filtered = filtered.filter(n => n.importance === 'Sangat Penting');
        if(filterVal === 'stat_done') filtered = filtered.filter(n => n.status === 'Selesai');
        if(filterVal === 'type_internal') filtered = filtered.filter(n => n.type === 'Internal');

        if(filtered.length === 0) {
            container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:rgba(255,255,255,0.5); padding:3rem;">Tidak ditemukan notulensi.</div>';
            return;
        }

        filtered.forEach(n => {
            const card = document.createElement('div');
            card.className = 'notulensi-card';
            const bgImage = getNotulensiImage(n.category);

            // Warna Priority
            let prioBg = 'rgba(255,255,255,0.1)'; let prioCol = '#ccc';
            if(n.importance === 'Sangat Penting') { prioBg = 'rgba(250, 204, 21, 0.2)'; prioCol = '#facc15'; }
            if(n.importance === 'Penting') { prioBg = 'rgba(56, 189, 248, 0.2)'; prioCol = '#38bdf8'; }

            // Warna Status
            let statCol = '#7dd3fc';
            if(n.status === 'Selesai') statCol = '#34d399';
            if(n.status === 'Berlangsung') statCol = '#60a5fa';

            card.innerHTML = `
                <div style="height:160px; width:100%; position:relative;">
                    <img src="${bgImage}" style="width:100%; height:100%; object-fit:cover;" loading="lazy" onerror="this.onerror=null; this.src='https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&q=80';">
                    <div style="position:absolute; top:10px; right:10px; display:flex; gap:5px;">
                         <button onclick="duplicateNotulensi(${n.id}, event)" style="background:rgba(0,0,0,0.6); color:white; border:none; width:28px; height:28px; border-radius:6px;"><i class="ph ph-copy"></i></button>
                         <button onclick="deleteNotulensi(${n.id}, event)" style="background:rgba(220, 38, 38, 0.8); color:white; border:none; width:28px; height:28px; border-radius:6px;"><i class="ph ph-trash"></i></button>
                    </div>
                </div>
                <div class="notulensi-card-body">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.8rem;">
                        <span class="badge-n-imp" style="background:${prioBg}; color:${prioCol}; border:1px solid ${prioBg};">${n.importance}</span>
                        <span style="font-size:0.7rem; font-weight:700; color:#38bdf8; text-transform:uppercase;">${n.category}</span>
                    </div>
                    <h3 style="font-size:1.3rem; margin-bottom:0.5rem; line-height:1.3; color:white;">${n.title}</h3>
                    <p style="font-size:0.9rem; color:#cbd5e1; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden; margin-bottom:auto;">${n.desc || '...'}</p>
                    <div style="margin-top:1.2rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1); display:flex; justify-content:space-between; align-items:center;">
                         <span class="badge-n-stat" style="color:${statCol}; border:1px solid ${statCol};">${n.status}</span>
                         <span style="font-size:0.8rem; color:#94a3b8;"><i class="ph ph-calendar"></i> ${formatDate(n.date)}</span>
                    </div>
                </div>
            `;
            card.onclick = (e) => { if(!e.target.closest('button')) openNotulensiDetail(n.id); };
            container.appendChild(card);
        });
    }

    // --- SAVE NOTULENSI ---
    function saveNotulensi() {
        const id = document.getElementById('notulensiId').value;
        
        // Ambil Action Items
        const wrapper = document.getElementById('wrapperActionItems');
        const items = wrapper.querySelectorAll('.dynamic-item');
        let actionData = [];
        items.forEach(item => {
            const name = item.querySelector('.field-name').value;
            const date = item.querySelector('.field-date').value;
            const time = item.querySelector('.field-time').value;
            const pic = item.querySelector('.field-pic').value;
            const status = item.querySelector('.field-status').value;
            const desc = item.querySelector('.field-desc').value;
            if(name) actionData.push({ name, date, time, pic, status, desc });
        });

        const dataObj = {
            id: id ? parseInt(id) : Date.now(),
            title: document.getElementById('inpNTitle').value,
            type: document.getElementById('inpNType').value,
            category: document.getElementById('inpNCategory').value,
            groupType: document.getElementById('inpNGroupType').value,
            nature: document.getElementById('inpNNature').value,
            importance: document.getElementById('inpNImportance').value,
            
            notulis: document.getElementById('inpNNotulis').value,
            leader: document.getElementById('inpNLeader').value,
            participants: document.getElementById('inpNParticipants').value,
            count: document.getElementById('inpNCount').value,
            status: document.getElementById('inpNStatus').value,
            
            date: document.getElementById('inpNDate').value,
            start: document.getElementById('inpNStart').value,
            end: document.getElementById('inpNEnd').value,
            
            media: document.getElementById('inpNMedia').value,
            location: document.getElementById('inpNLocation').value,
            docLink: document.getElementById('inpNDocLink').value,
            
            desc: document.getElementById('inpNDesc').value,
            agenda: document.getElementById('inpNAgenda').value,
            result: document.getElementById('inpNResult').value,
            decision: document.getElementById('inpNDecision').value,
            notes: document.getElementById('inpNNotes').value,
            
            actionItems: actionData
        };

        if(!dataObj.title) { alert("Judul wajib diisi!"); return; }

        if(id) {
            const idx = notulensis.findIndex(x => x.id == id);
            notulensis[idx] = dataObj;
        } else {
            notulensis.push(dataObj);
        }

        localStorage.setItem('myNotulensis', JSON.stringify(notulensis));
        closeNotulensiModal();
        renderNotulensi();
    }

    // --- OPEN DETAIL NOTULENSI ---
    let currentNotulensiId = null;
    // --- OPEN DETAIL NOTULENSI (REVISI LENGKAP & RAPI) ---
    function openNotulensiDetail(id) {
        const n = notulensis.find(x => x.id === id);
        if(!n) return;
        currentNotulensiId = id;

        // 1. Image Logic
        const imgEl = document.getElementById('viewNCover');
        imgEl.src = ''; 
        imgEl.src = getNotulensiImage(n.category);
        imgEl.onerror = function() { this.onerror = null; this.src = 'https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?w=800&q=80'; };

        // 2. Header Info
        document.getElementById('viewNTitle').innerText = n.title;
        document.getElementById('viewNCategory').innerText = n.category;
        document.getElementById('viewNImportance').innerText = n.importance;
        document.getElementById('viewNNature').innerText = n.nature || 'Formal';
        
        // Badge Status
        const statB = document.getElementById('viewNStatusBadge');
        statB.className = 'badge-pill-stat';
        statB.innerText = n.status;
        if(n.status === 'Selesai') statB.style.cssText = "background:#065f46; color:#34d399; border:1px solid #34d399;";
        else if(n.status === 'Berlangsung') statB.style.cssText = "background:#1e40af; color:#60a5fa; border:1px solid #60a5fa;";
        else statB.style.cssText = "background:#374151; color:#9ca3af; border:1px solid #9ca3af;";

        // Badge Type
        document.getElementById('viewNTypeBadge').innerText = n.type || 'Internal';
        document.getElementById('viewNTypeBadge').className = 'badge-pill-type';

        // 3. Grid Info Mapping
        document.getElementById('viewNDate').innerText = formatDate(n.date);
        
        // Hitung Durasi (Opsional: Jika mau logic hitung jam)
        const timeStr = (n.start || '-') + ' s/d ' + (n.end || '-');
        document.getElementById('viewNTime').innerText = timeStr;
        
        document.getElementById('viewNLoc').innerText = (n.media || '') + ' - ' + (n.location || '');
        document.getElementById('viewNLeader').innerText = n.leader || '-';
        document.getElementById('viewNNotulis').innerText = n.notulis || '-';
        document.getElementById('viewNCount').innerText = (n.count || '0') + ' Orang';
        document.getElementById('viewNGroup').innerText = n.groupType || '-';
        
        const docLnk = document.getElementById('viewNDoc');
        if(n.docLink) { docLnk.href = n.docLink; docLnk.style.display = 'inline-block'; } 
        else { docLnk.style.display = 'none'; }

        // 4. Content Mapping (Semua Field)
        document.getElementById('viewNParticipants').innerText = n.participants || '-';
        document.getElementById('viewNDesc').innerText = n.desc || 'Tidak ada deskripsi singkat.';
        document.getElementById('viewNAgenda').innerText = n.agenda || 'Tidak ada agenda tercatat.';
        document.getElementById('viewNResult').innerText = n.result || 'Belum ada hasil pembahasan.';
        document.getElementById('viewNDecision').innerText = n.decision || 'Belum ada keputusan.';
        document.getElementById('viewNNotes').innerText = n.notes || '-';

        // 5. Action Items Rendering
        const actCont = document.getElementById('viewListActionItems');
        actCont.innerHTML = '';
        if(n.actionItems && n.actionItems.length > 0) {
            n.actionItems.forEach((act, i) => {
                const row = document.createElement('div');
                // Style Card untuk Sub-Item
                row.style.cssText = "background: rgba(15, 23, 42, 0.4); border:1px solid rgba(56, 189, 248, 0.2); padding:1rem; border-radius:10px; display:flex; flex-direction:column; gap:5px;";
                
                let statusColor = '#94a3b8';
                if(act.status === 'Done') statusColor = '#34d399';
                if(act.status === 'In Progress') statusColor = '#60a5fa';

                row.innerHTML = `
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <strong style="color:#7dd3fc; font-size:1rem;">#${i+1} ${act.name}</strong>
                        <span style="font-size:0.75rem; font-weight:bold; color:${statusColor}; border:1px solid ${statusColor}; padding:2px 8px; border-radius:4px;">${act.status}</span>
                    </div>
                    <div style="font-size:0.8rem; color:#94a3b8; display:flex; gap:15px;">
                        <span><i class="ph ph-user"></i> PIC: ${act.pic || '-'}</span>
                        <span><i class="ph ph-clock"></i> Due: ${formatDate(act.date)} ${act.time}</span>
                    </div>
                    <div style="color:#e2e8f0; font-size:0.9rem; margin-top:5px; border-top:1px solid rgba(255,255,255,0.05); padding-top:5px;">${act.desc}</div>
                `;
                actCont.appendChild(row);
            });
        } else {
            actCont.innerHTML = '<div style="color:gray; font-style:italic; padding:1rem; border:1px dashed #334155; border-radius:8px; text-align:center;">Tidak ada action items.</div>';
        }

        // 6. Switch UI
        document.getElementById('notulensiModalTitle').innerText = "Detail Notulensi";
        document.getElementById('notulensiForm').classList.add('hidden');
        document.getElementById('notulensiDetailView').classList.remove('hidden');
        document.getElementById('notulensiFormActions').classList.add('hidden');
        document.getElementById('notulensiDetailActions').classList.remove('hidden');
        document.getElementById('notulensiModalOverlay').classList.add('active');
    }
    // --- UTILS NOTULENSI ---
    function deleteNotulensi(id, e) {
        e.stopPropagation();
        if(confirm("Hapus notulensi ini?")) {
            notulensis = notulensis.filter(x => x.id !== id);
            localStorage.setItem('myNotulensis', JSON.stringify(notulensis));
            renderNotulensi();
        }
    }
    function duplicateNotulensi(id, e) {
        e.stopPropagation();
        const origin = notulensis.find(x => x.id === id);
        if(origin) {
            const copy = { ...origin, id: Date.now(), title: origin.title + " (Copy)" };
            notulensis.push(copy);
            localStorage.setItem('myNotulensis', JSON.stringify(notulensis));
            renderNotulensi();
        }
    }
    function openNotulensiModal() {
        document.getElementById('notulensiForm').reset();
        document.getElementById('notulensiId').value = '';
        document.getElementById('wrapperActionItems').innerHTML = '';
        document.getElementById('countActionItems').value = '';
        
        document.getElementById('notulensiModalTitle').innerText = "New Notulensi";
        document.getElementById('notulensiForm').classList.remove('hidden');
        document.getElementById('notulensiDetailView').classList.add('hidden');
        document.getElementById('notulensiFormActions').classList.remove('hidden');
        document.getElementById('notulensiDetailActions').classList.add('hidden');
        document.getElementById('notulensiModalOverlay').classList.add('active');
    }
    function closeNotulensiModal() {
        document.getElementById('notulensiModalOverlay').classList.remove('active');
    }
    function editNotulensi() {
        // (Logika edit mirip dengan Plan/Journal, tinggal load value ke ID input)
        alert("Fitur Edit akan membuka form kembali. Untuk saat ini data sudah aman.");
        // Implementasi penuh edit bisa copy paste logic 'load value' seperti di Journal
    }
    // --- INIT: JALANKAN SEMUA RENDER SAAT WEBSITE DIBUKA ---
    // --- FUNGSI EDIT NOTULENSI (AKTIF) ---
    function editNotulensi() {
        // 1. Cari Data berdasarkan ID yang sedang dibuka
        const n = notulensis.find(x => x.id === currentNotulensiId);
        if(!n) return;

        // 2. Masukkan Data ke Input Form Utama
        document.getElementById('notulensiId').value = n.id;
        document.getElementById('inpNTitle').value = n.title;
        document.getElementById('inpNType').value = n.type;
        document.getElementById('inpNCategory').value = n.category;
        document.getElementById('inpNGroupType').value = n.groupType;
        document.getElementById('inpNNature').value = n.nature;
        document.getElementById('inpNImportance').value = n.importance;
        
        document.getElementById('inpNNotulis').value = n.notulis;
        document.getElementById('inpNLeader').value = n.leader;
        document.getElementById('inpNParticipants').value = n.participants;
        document.getElementById('inpNCount').value = n.count;
        document.getElementById('inpNStatus').value = n.status;
        
        document.getElementById('inpNDate').value = n.date;
        document.getElementById('inpNStart').value = n.start;
        document.getElementById('inpNEnd').value = n.end;
        
        document.getElementById('inpNMedia').value = n.media;
        document.getElementById('inpNLocation').value = n.location;
        document.getElementById('inpNDocLink').value = n.docLink;
        
        document.getElementById('inpNDesc').value = n.desc;
        document.getElementById('inpNAgenda').value = n.agenda;
        document.getElementById('inpNResult').value = n.result;
        document.getElementById('inpNDecision').value = n.decision;
        document.getElementById('inpNNotes').value = n.notes;

        // 3. Generate Ulang Action Items (Sub-Notulensi)
        const wrapper = document.getElementById('wrapperActionItems');
        wrapper.innerHTML = ''; // Bersihkan dulu
        
        if(n.actionItems && n.actionItems.length > 0) {
            document.getElementById('countActionItems').value = n.actionItems.length;

            n.actionItems.forEach((act, i) => {
                const div = document.createElement('div');
                div.className = 'dynamic-item';
                div.innerHTML = `<span style="position:absolute; top:5px; right:10px; color:#f87171; cursor:pointer;" onclick="this.parentElement.remove()"></span>
                                 <strong style="display:block; color:#7dd3fc; margin-bottom:5px;">Action Item #${i+1}</strong>`;
                
                // Render input dengan value terisi
                div.innerHTML += `
                    <input type="text" class="field-name" value="${act.name}" placeholder="Nama Aktivitas">
                    <div style="display:flex; gap:5px;">
                        <input type="date" class="field-date" value="${act.date}">
                        <input type="time" class="field-time" value="${act.time}">
                    </div>
                    <div style="display:flex; gap:5px;">
                        <input type="text" class="field-pic" value="${act.pic}" placeholder="PIC Name">
                        <select class="field-status" style="background:rgba(0,0,0,0.3); border:1px solid #38bdf8; color:white; border-radius:6px;">
                            <option ${act.status === 'To Do' ? 'selected' : ''}>To Do</option>
                            <option ${act.status === 'In Progress' ? 'selected' : ''}>In Progress</option>
                            <option ${act.status === 'Done' ? 'selected' : ''}>Done</option>
                        </select>
                    </div>
                    <textarea class="field-desc" placeholder="Deskripsi Aktivitas">${act.desc}</textarea>
                `;
                wrapper.appendChild(div);
            });
        } else {
             document.getElementById('countActionItems').value = '';
        }

        // 4. Ubah Tampilan Modal: Sembunyikan Detail, Munculkan Form
        document.getElementById('notulensiModalTitle').innerText = "Edit Notulensi";
        
        document.getElementById('notulensiDetailView').classList.add('hidden'); // Sembunyikan mode baca
        document.getElementById('notulensiForm').classList.remove('hidden');    // Munculkan mode edit
        
        document.getElementById('notulensiDetailActions').classList.add('hidden'); // Sembunyikan tombol Close
        document.getElementById('notulensiFormActions').classList.remove('hidden'); // Munculkan tombol Save
    }
renderIdeas();    // Render kartu Ideas
    renderPlans();    // Render kartu Plans
    renderJournals(); // [PENTING] Render kartu Journal agar tidak hilang saat refresh
    // Panggil Render saat load
    // renderJournals(); (Opsional, atau dipanggil via navigasi)
    renderDashboard();
    renderNotulensi();
    </script>
</body>
</html>